{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import { IOEndpoint, IOPromise, createIOPromise } from 'type-r'\r\n\r\nexport type Index = ( number | string )[];\r\n\r\nexport function create( init = [], delay = 50 ){\r\n    return new MemoryEndpoint( init, delay );\r\n}\r\n\r\nexport { create as memoryIO };\r\n\r\nexport class MemoryEndpoint implements IOEndpoint {\r\n    resolve( value ){\r\n        return createIOPromise( ( resolve, reject ) => {\r\n            setTimeout( () => resolve( value ), this.delay );\r\n        });\r\n    }\r\n    \r\n    reject( value ){\r\n        return createIOPromise( ( resolve, reject ) => {\r\n            setTimeout( () => reject( value ), this.delay );\r\n        });\r\n    }\r\n\r\n    constructor( init : object[], public delay : number ){\r\n        for( let obj of init ){\r\n            this.create( obj, {} );\r\n        }\r\n    }\r\n\r\n    index : Index = [ 0 ];\r\n    items = {};\r\n\r\n    generateId( a_id ){\r\n        // Update index counter...\r\n        const id = Number( a_id );\r\n        if( !isNaN( id ) ){\r\n            this.index[ 0 ] = Math.max( this.index[ 0 ] as number, id );\r\n        }\r\n\r\n        // Return id...\r\n        return a_id || String( ( this.index[ 0 ] as number ) ++ );\r\n    }\r\n\r\n    create( json, options ) {\r\n        const id = json.id = this.generateId( json.id );\r\n        this.index.push( id );\r\n        this.items[ id ] = json;\r\n        return this.resolve({ id });\r\n    }\r\n\r\n    update( id, json, options ) {\r\n        this.items[ id ] = json;\r\n        return this.resolve( {} );\r\n    }\r\n\r\n    read( id, options ){\r\n        const existing = this.items[ id ];\r\n        return existing ?\r\n            this.resolve( existing ) : \r\n            this.reject( \"Not found\" );\r\n    }\r\n\r\n    destroy( id, options ){\r\n        const existing = this.items[ id ];\r\n        if( existing ){\r\n            delete this.items[ id ];\r\n            this.index = this.index.filter( x => x !== id );\r\n            return this.resolve( {} );\r\n        }\r\n        else{\r\n            return this.reject( \"Not found\" );\r\n        }\r\n    }\r\n\r\n    list( options? : object ) {\r\n        return this.resolve( this.index.slice( 1 ).map( id => this.items[ id ]) );\r\n    }\r\n\r\n    subscribe( events ) : any {}\r\n    unsubscribe( events) : any {}\r\n}"],"names":["create","init","delay","MemoryEndpoint","this","init_1","_i","obj","value","createIOPromise","resolve","reject","setTimeout","_this","a_id","id","Number","isNaN","index","Math","max","String","json","options","generateId","push","items","existing","filter","x","slice","map","events"],"mappings":"0OAIgBA,EAAQC,EAAWC,GAC/B,oBADoBD,mBAAWC,MACxB,IAAIC,EAAgBF,EAAMC,oBAkBjC,WAAaD,EAAwBC,GAAAE,WAAAF,EAMrCE,WAAgB,CAAE,GAClBA,WAAQ,GANJ,IAAgB,QAAAC,IAAAC,WAAAA,IAAM,CAAjB,IAAIC,OACLH,KAAKJ,OAAQO,EAAK,KAuD9B,OArEIJ,oBAAA,SAASK,GAAT,WACI,OAAOC,kBAAiB,SAAEC,EAASC,GAC/BC,WAAY,WAAM,OAAAF,EAASF,IAASK,EAAKX,UAIjDC,mBAAA,SAAQK,GAAR,WACI,OAAOC,kBAAiB,SAAEC,EAASC,GAC/BC,WAAY,WAAM,OAAAD,EAAQH,IAASK,EAAKX,UAahDC,uBAAA,SAAYW,GAER,IAAMC,EAAKC,OAAQF,GAMnB,OALKG,MAAOF,KACRX,KAAKc,MAAO,GAAMC,KAAKC,IAAKhB,KAAKc,MAAO,GAAeH,IAIpDD,GAAQO,OAAUjB,KAAKc,MAAO,OAGzCf,mBAAA,SAAQmB,EAAMC,GACV,IAAMR,EAAKO,EAAKP,GAAKX,KAAKoB,WAAYF,EAAKP,IAG3C,OAFAX,KAAKc,MAAMO,KAAMV,GACjBX,KAAKsB,MAAOX,GAAOO,EACZlB,KAAKM,QAAQ,CAAEK,QAG1BZ,mBAAA,SAAQY,EAAIO,EAAMC,GAEd,OADAnB,KAAKsB,MAAOX,GAAOO,EACZlB,KAAKM,QAAS,KAGzBP,iBAAA,SAAMY,EAAIQ,GACN,IAAMI,EAAWvB,KAAKsB,MAAOX,GAC7B,OAAOY,EACHvB,KAAKM,QAASiB,GACdvB,KAAKO,OAAQ,cAGrBR,oBAAA,SAASY,EAAIQ,GAET,OADiBnB,KAAKsB,MAAOX,WAElBX,KAAKsB,MAAOX,GACnBX,KAAKc,MAAQd,KAAKc,MAAMU,OAAQ,SAAAC,GAAK,OAAAA,IAAMd,IACpCX,KAAKM,QAAS,KAGdN,KAAKO,OAAQ,cAI5BR,iBAAA,SAAMoB,GAAN,WACI,OAAOnB,KAAKM,QAASN,KAAKc,MAAMY,MAAO,GAAIC,IAAK,SAAAhB,GAAM,OAAAF,EAAKa,MAAOX,OAGtEZ,sBAAA,SAAW6B,KACX7B,wBAAA,SAAa6B"}