!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react"),require("@type-r/models")):"function"==typeof define&&define.amd?define(["exports","react","@type-r/models"],e):e((t=t||self).Nested={},t.React,t.Nested)}(this,function(t,u,e){"use strict";var n=s(function(t){return new o(new t)}),r={of:s(function(t){return new o(new(e.Collection.of(t)))}),ofRefs:s(function(t){return new o(new(e.Collection.ofRefs(t)))}),subsetOf:s(function(t){return new o(t.createSubset([]))})},o=(i.prototype.getStore=function(){return this.value._defaultStore},i);function i(t){this.value=t,this._onChildrenChange=void 0,this._changeToken=t._changeToken,t._owner=this,t._ownerKey||(t._ownerKey="reactState")}function a(t){if(t._changeToken===t.value._changeToken)return t;var e=new o(t.value);return e._onChildrenChange=t._onChildrenChange,e}function s(o){return function(t){var e=u.useReducer(a,t,o),n=e[0],r=e[1];return u.useEffect(function(){return n._onChildrenChange=function(t){return r(t)},function(){return n.value.dispose()}},c),n.value}}var c=[];var f=[];function l(){return u.useReducer(p,null)[1]}function p(t,e){return e._changeToken}var h=function(t,e){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function v(t,e){function n(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var y=function(){return(y=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},d=Array.prototype,g=Object.prototype;function k(t){if(t&&"object"==typeof t)switch(Object.getPrototypeOf(t)){case d:return b;case g:return m}return w}var w={clone:function(t){return t},map:function(t,e){return[]},remove:function(t){return t}},m={map:function(t,e){var n=[],r=t.value;for(var o in r)if(r.hasOwnProperty(o)){var u=e(t.at(o),o);void 0===u||n.push(u)}return n},remove:function(t,e){return delete t[e],t},clone:function(t){return y({},t)}},b={clone:function(t){return t.slice()},remove:function(t,e){return t.splice(e,1),t},map:function(t,e){for(var n=t.value.length,r=Array(n),o=0,u=0;o<n;o++){var i=e(t.at(o),o);void 0===i||(r[u++]=i)}return r.length===u||(r.length=u),r}},O=(_.value=function(t,e){return new S(t,e)},_.getValues=function(t){return K(t,"value")},Object.defineProperty(_.prototype,"current",{get:function(){return this.value},set:function(t){this.set(t)},enumerable:!0,configurable:!0}),Object.defineProperty(_.prototype,"_changeToken",{get:function(){return this.value},enumerable:!0,configurable:!0}),_.getErrors=function(t){return K(t,"error")},_.hasErrors=function(t){for(var e in t)if(t.hasOwnProperty(e)&&t[e].error)return!0;return!1},_.setValues=function(t,e){if(e)for(var n in t){var r=U(n);if(e.hasOwnProperty(r)){var o=e[r];void 0===o||t[n].set(o)}}},_.prototype.onChange=function(e){var n=this;return new P(this,function(t){e(t),n.set(t)})},Object.defineProperty(_.prototype,"props",{get:function(){var e=this;return"boolean"==typeof this.value?{checked:this.value,onChange:function(t){return e.set(Boolean(t.target.checked))}}:{value:this.value,onChange:function(t){return e.set(t.target.value)}}},enumerable:!0,configurable:!0}),_.prototype.update=function(t,e){var n=t(this.clone(),e);void 0===n||this.set(n)},_.prototype.pipe=function(n){var r=this;return new P(this,function(t){var e=n(t,r.value);void 0===e||r.set(e)})},_.prototype.action=function(e){var n=this;return function(t){return n.update(e,t)}},_.prototype.equals=function(t){return new E(this,t)},_.prototype.enabled=function(t){return new $(this,t||"")},_.prototype.contains=function(t){return new q(this,t)},_.prototype.push=function(){var t=b.clone(this.value);Array.prototype.push.apply(t,arguments),this.set(t)},_.prototype.unshift=function(){var t=b.clone(this.value);Array.prototype.unshift.apply(t,arguments),this.set(t)},_.prototype.splice=function(){var t=b.clone(this.value);Array.prototype.splice.apply(t,arguments),this.set(t)},_.prototype.map=function(t){return k(this.value).map(this,t)},_.prototype.removeAt=function(t){var e=this.value,n=k(e);this.set(n.remove(n.clone(e),t))},_.prototype.at=function(t){return new H(this,t)},_.prototype.clone=function(){var t=this.value;return k(t).clone(t)},_.prototype.pick=function(){for(var t={},e=arguments.length?arguments:Object.keys(this.value),n=0;n<e.length;n++){var r=e[n];t[r]=new H(this,r)}return t},_.prototype.$links=function(){var t={},e=this.value;for(var n in e)e.hasOwnProperty(n)&&(t["$"+n]=new H(this,n));return t},_.prototype.check=function(t,e){return this.error||t(this.value)||(this.error=e||t.error||M),this},_);function _(t){this.value=t}var C,S=(v(j,C=O),j.prototype.set=function(t){},j);function j(t,e){var n=C.call(this,t)||this;return n.set=e,n}var L,P=(v(V,L=O),V.prototype.set=function(t){},V);function V(t,e){var n=L.call(this,t.value)||this;n.set=e;var r=t.error;return r&&(n.error=r),n}var R,E=(v(A,R=O),A.prototype.set=function(t){this.parent.set(t?this.truthyValue:null)},A);function A(t,e){var n=R.call(this,t.value===e)||this;return n.parent=t,n.truthyValue=e,n}var T,$=(v(B,T=O),B.prototype.set=function(t){this.parent.set(t?this.defaultValue:null)},B);function B(t,e){var n=T.call(this,null!=t.value)||this;return n.parent=t,n.defaultValue=e,n}var I,q=(v(x,I=O),x.prototype.set=function(t){var e=this,n=Boolean(t);if(this.value!==n){var r=this.parent.value,o=t?r.concat(this.element):r.filter(function(t){return t!==e.element});this.parent.set(o)}},x);function x(t,e){var n=I.call(this,0<=t.value.indexOf(e))||this;return n.parent=t,n.element=e,n}var N,M="Invalid value",H=(v(J,N=O),J.prototype.remove=function(){this.parent.removeAt(this.key)},J.prototype.set=function(e){var n=this;this.value!==e&&this.parent.update(function(t){return t[n.key]=e,t})},J);function J(t,e){var n=N.call(this,t.value[e])||this;return n.parent=t,n.key=e,n}function K(t,e){var n={};for(var r in t)if(t.hasOwnProperty(r)){var o=t[r][e];void 0!==o&&(n[U(r)]=o)}return n}function U(t){return"$"===t[0]?t.slice(1):t}var F,z=(v(D,F=u.Component),D.prototype.linkAt=function(t){return this.$at(t)},D.prototype.$at=function(t){var e=this.state[t],n=this.links||(this.links={}),r=n[t];return r&&r.value===e?r:n[t]=new Q(this,t,e)},D.prototype.linkAll=function(){return this.state$.apply(this,arguments)},D.prototype.state$=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this.state,r=this.links||(this.links={}),o=0,u=t.length?t:Object.keys(n);o<u.length;o++){var i=u[o],a=n[i],s=r[i];s&&s.value===a||(r[i]=new Q(this,i,a))}return r},D);function D(){var t=null!==F&&F.apply(this,arguments)||this;return t.links=null,t}var G,Q=(v(W,G=O),W.prototype.set=function(t){var e={};e[this.key]=t,this.component.setState(e)},W);function W(t,e,n){var r=G.call(this,n)||this;return r.component=t,r.key=e,r}var X,Y=(v(Z,X=O),Z.prototype.set=function(t){},Z.prototype.update=function(r,o){this.set(function(t){var e=k(t).clone(t),n=r(e,o);return void 0===n?t:n})},Z);function Z(t,e){var n=X.call(this,t)||this;return n.set=e,n}function tt(t){var e=u.useState(t),n=e[0],r=e[1];return new Y(n,r)}function et(t){var e=u.useState(t),n=e[0],r=e[1],o=nt();return new Y(n,function(t){return o.current&&r(t)})}function nt(){var t=u.useRef(!0);return u.useEffect(function(){return function(){return t.current=!1}},[]),t}function rt(t){var e=t instanceof O?t.value:t,n=tt(e);return u.useEffect(function(){return n.set(e)},[e]),n}function ot(t){var e=t instanceof O?t.value:t,n=et(e);return u.useEffect(function(){return n.set(e)},[e]),n}function ut(t){return t&&void 0!==t._changeToken?t._changeToken:t}t.ClonedValueLink=P,t.ContainsRef=q,t.CustomValueLink=S,t.EnabledValueLink=$,t.EqualsValueLink=E,t.Link=O,t.LinkedComponent=z,t.PropValueLink=H,t.StateLink=Q,t.UseStateLink=Y,t.ValueLink=O,t.arrayHelpers=b,t.helpers=k,t.objectHelpers=m,t.useBoundLink=rt,t.useBoundStateRef=rt,t.useChanges=function(e){var n=l();u.useEffect(function(){function t(t){n(t)}return e.onChanges(t),function(){return e.offChanges(t)}},f)},t.useCollection=r,t.useForceUpdate=l,t.useIO=function(t,e){void 0===e&&(e=[]);var n=et(null);return u.useEffect(function(){n.set(function(t){return(t||0)+1}),t().finally(function(){return n.set(function(t){return t-1})})},e),null!==n.value&&!n.value},t.useIsMountedRef=nt,t.useLink=tt,t.useLocalStorage=function(e,t){var n=u.useRef();n.current=t,u.useEffect(function(){var t=JSON.parse(localStorage.getItem(e)||"{}");return O.setValues(n.current,t),function(){var t=O.getValues(n.current);localStorage.setItem(e,JSON.stringify(t))}},[])},t.useModel=n,t.useSafeBoundLink=ot,t.useSafeBoundStateRef=ot,t.useSafeLink=et,t.useSafeStateRef=et,t.useState$=tt,t.whenChanged=function(t,e,n,r){var o=arguments.length;switch(o){case 1:return[ut(t)];case 2:return[ut(t),ut(e)];case 3:return[ut(t),ut(e),ut(n)];default:for(var u=[ut(t),ut(e),ut(n),ut(r)],i=4;i<o;i++)u.push(ut(arguments[i]));return u}},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
