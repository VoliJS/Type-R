{"version":3,"file":"index.js","sources":["../../../node_modules/tslib/tslib.es6.js","../../memory/src/index.ts","../src/restful.ts","../src/fetchModel.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import { IOEndpoint, IOPromise, createIOPromise } from 'type-r'\n\nexport type Index = ( number | string )[];\n\nexport function create( init = [], delay = 50 ){\n    return new MemoryEndpoint( init, delay );\n}\n\nexport { create as memoryIO };\n\nexport class MemoryEndpoint implements IOEndpoint {\n    resolve( value ){\n        return createIOPromise( ( resolve, reject ) => {\n            setTimeout( () => resolve( value ), this.delay );\n        });\n    }\n    \n    reject( value ){\n        return createIOPromise( ( resolve, reject ) => {\n            setTimeout( () => reject( value ), this.delay );\n        });\n    }\n\n    constructor( init : object[], public delay : number ){\n        for( let obj of init ){\n            this.create( obj, {} );\n        }\n    }\n\n    index : Index = [ 0 ];\n    items = {};\n\n    generateId( a_id ){\n        // Update index counter...\n        const id = Number( a_id );\n        if( !isNaN( id ) ){\n            this.index[ 0 ] = Math.max( this.index[ 0 ] as number, id );\n        }\n\n        // Return id...\n        return a_id || String( ( this.index[ 0 ] as number ) ++ );\n    }\n\n    create( json, options ) {\n        const id = json.id = this.generateId( json.id );\n        this.index.push( id );\n        this.items[ id ] = json;\n        return this.resolve({ id });\n    }\n\n    update( id, json, options ) {\n        this.items[ id ] = json;\n        return this.resolve( {} );\n    }\n\n    read( id, options ){\n        const existing = this.items[ id ];\n        return existing ?\n            this.resolve( existing ) : \n            this.reject( \"Not found\" );\n    }\n\n    destroy( id, options ){\n        const existing = this.items[ id ];\n        if( existing ){\n            delete this.items[ id ];\n            this.index = this.index.filter( x => x !== id );\n            return this.resolve( {} );\n        }\n        else{\n            return this.reject( \"Not found\" );\n        }\n    }\n\n    list( options? : object ) {\n        return this.resolve( this.index.slice( 1 ).map( id => this.items[ id ]) );\n    }\n\n    subscribe( events ) : any {}\n    unsubscribe( events) : any {}\n}","import { IOEndpoint, IOOptions, IOPromise, createIOPromise } from 'type-r'\nimport { memoryIO, MemoryEndpoint } from '../../memory'\n\nexport function create( url : string, fetchOptions? : Partial<RestfulFetchOptions> ){\n    return new RestfulEndpoint( url, fetchOptions );\n}\n\nexport { create as restfulIO }\n\nexport type HttpMethod = 'GET' | 'POST' | 'UPDATE' | 'DELETE' | 'PUT'\n\nexport interface RestfulIOOptions extends IOOptions {\n    params? : object,\n    options? : RequestInit\n}\n\nexport type RestfulFetchOptions = /* subset of RequestInit */{\n    cache?: RequestCache;\n    credentials?: RequestCredentials;\n    mode?: RequestMode;\n    redirect?: RequestRedirect;\n    referrerPolicy?: ReferrerPolicy;\n    mockData? : any\n    simulateDelay? : number \n}\n\nexport class RestfulEndpoint implements IOEndpoint {\n    constructor( public url : string, { mockData, simulateDelay = 1000, ...fetchOptions } : RestfulFetchOptions = {}) {\n        this.fetchOptions = fetchOptions\n        this.memoryIO =  mockData ? memoryIO( mockData, simulateDelay ) : null;\n    }\n\n    fetchOptions : RestfulFetchOptions\n    memoryIO : MemoryEndpoint\n\n    public static defaultFetchOptions : RestfulFetchOptions = {\n        cache: \"no-cache\",\n        credentials: \"same-origin\",\n        mode: \"cors\",\n        redirect: \"error\",\n    }\n\n    create( json, options : RestfulIOOptions, record ) {\n        return this.memoryIO ?\n            this.memoryIO.create.apply( this.memoryIO, arguments ) :\n            this.request( 'POST', this.collectionUrl( record, options ), options, json );\n    }\n\n    update( id, json, options : RestfulIOOptions, record ) {\n        return this.memoryIO ?\n            this.memoryIO.update.apply( this.memoryIO, arguments ) :\n            this.request( 'PUT', this.objectUrl( record, id, options ), options, json );\n    }\n\n    read( id, options : IOOptions, record ){\n        return this.memoryIO ?\n            this.memoryIO.read.apply( this.memoryIO, arguments ) :\n            this.request( 'GET', this.objectUrl( record, id, options ), options );\n        }\n\n    destroy( id, options : RestfulIOOptions, record ){\n        return this.memoryIO ?\n            this.memoryIO.destroy.apply( this.memoryIO, arguments ) :\n            this.request( 'DELETE', this.objectUrl( record, id, options ), options );\n    }\n\n    list( options : RestfulIOOptions, collection ) {\n        return this.memoryIO ?\n            this.memoryIO.list.apply( this.memoryIO, arguments ) :\n            this.request( 'GET', this.collectionUrl( collection, options ), options );\n    }\n\n    subscribe( events ) : any {}\n    unsubscribe( events ) : any {}\n\n\n    protected isRelativeUrl( url ) {\n        return url.indexOf( './' ) === 0;\n    }\n\n    protected removeTrailingSlash( url : string ) {\n        const endsWithSlash = url.charAt( url.length - 1 ) === '/';\n        return endsWithSlash ? url.substr( 0, url.length - 1 ) : url;\n    }\n\n    protected getRootUrl( recordOrCollection ) {\n        const { url } = this\n        if( this.isRelativeUrl( url ) ) {\n            const owner         = recordOrCollection.getOwner(),\n                  ownerUrl      = owner.getEndpoint().getUrl( owner );\n\n            return this.removeTrailingSlash( ownerUrl ) + '/' + url.substr( 2 )\n        } else {\n            return url;\n        }\n    }\n\n    protected getUrl( record ) {\n        const url = this.getRootUrl( record );\n        return record.isNew()\n            ? url\n            : this.removeTrailingSlash( url ) + '/' + record.id\n    }\n\n    protected objectUrl( record, id, options ){\n        return appendParams( this.getUrl( record ), options.params );\n    }\n\n    protected collectionUrl( collection, options ){\n        return appendParams( this.getRootUrl( collection ), options.params );\n    }\n\n    protected buildRequestOptions( method : string, options? : RequestInit, body? ) : RequestInit {\n        const mergedOptions : RequestInit = {\n            ...RestfulEndpoint.defaultFetchOptions,\n            ...this.fetchOptions,\n            ...options\n        };\n\n        const {headers, ...rest}          = mergedOptions,\n              resultOptions : RequestInit = {\n                  method,\n                  headers: {\n                      'Content-Type': 'application/json',\n                      ...headers\n                  },\n                  ...rest\n              };\n\n        if( body ) {\n            resultOptions.body = JSON.stringify( body );\n        }\n        return resultOptions;\n    }\n\n    protected request( method : HttpMethod, url : string, {options} : RestfulIOOptions, body? ) : Promise<any> {\n\n        return fetch( url, this.buildRequestOptions( method, options, body ) )\n            .then( response => {\n                if( response.ok ) {\n                    return response.json()\n                } else {\n                    throw new Error( response.statusText )\n                }\n            } );\n    }\n}\n\nfunction appendParams( url, params? ) {\n    var esc = encodeURIComponent;\n    return params\n        ? url + '?' + Object.keys( params )\n                          .map( k => esc( k ) + '=' + esc( params[ k ] ) )\n                          .join( '&' )\n        : url;\n}\n\n\n","import { Model, define } from 'type-r';\nimport { RestfulFetchOptions, RestfulEndpoint, RestfulIOOptions, HttpMethod } from './restful';\n\nexport type ConstructUrl = ( params : { [ key : string ] : any }, model? : Model ) => string;\n\n/**\n * Implement custom model.fetch() according to the given rules.\n * All other I/O methods are not supported, this is read-only model.\n * \n * @param method HTTP Method to use\n * @param url template function to generate the URL\n * @param options options coming from `model.fetch( options )`\n */\nexport function fetchModelIO( method : HttpMethod, url : ConstructUrl, options? : RestfulFetchOptions ){\n    return new ModelFetchEndpoint( method, url, options );\n}\n\nfunction notSupported( method ){\n    throw new ReferenceError( `Method ${method} is not supported. modelFetchIO supports only model.fetch().` );\n} \n\n@define class ModelFetchEndpoint extends RestfulEndpoint {\n    constructor(\n        public method : HttpMethod,\n        public constructUrl : ConstructUrl,\n        { mockData, ...options } : RestfulFetchOptions = {}\n    ){\n        super( '', mockData ? { mockData : [ mockData ], ...options } : options );\n    }\n\n    async list(){ notSupported( 'collection.fetch()') }\n    async destroy(){ notSupported( 'model.destroy()') }\n    async create(){ notSupported( 'model.save()') }\n    async update(){ notSupported( 'model.save()') }\n\n    async read( id, options : RestfulIOOptions, model : Model ){\n        if( this.memoryIO ){\n            return ( await this.memoryIO.list( options ) )[ 0 ];\n        }\n        else{\n            this.url = this.constructUrl( options.params, model );\n            return this.request( this.method, this.getRootUrl( model ), options );    \n        }\n    }\n}"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__assign","assign","t","s","i","n","arguments","length","prototype","call","apply","this","__rest","e","indexOf","getOwnPropertySymbols","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","rejected","result","done","then","__generator","body","f","y","g","_","label","sent","trys","ops","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","init","delay","init_1","_i","obj","create","MemoryEndpoint","createIOPromise","setTimeout","_this","a_id","id","Number","isNaN","index","Math","max","String","json","options","generateId","items","existing","filter","x","slice","map","events","url","fetchOptions","RestfulEndpoint","_a","mockData","_b","simulateDelay","memoryIO","record","request","collectionUrl","update","objectUrl","read","destroy","collection","list","charAt","substr","recordOrCollection","isRelativeUrl","owner","getOwner","ownerUrl","getEndpoint","getUrl","removeTrailingSlash","getRootUrl","isNew","appendParams","params","method","mergedOptions","defaultFetchOptions","headers","rest","resultOptions","Content-Type","JSON","stringify","fetch","buildRequestOptions","response","ok","Error","statusText","cache","credentials","mode","redirect","esc","encodeURIComponent","keys","k","join","notSupported","ReferenceError","constructUrl","_super","__","constructor","tslib_1.__extends","ModelFetchEndpoint","model","decorators","target","key","desc","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","define"],"mappings":"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"}