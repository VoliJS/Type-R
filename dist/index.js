!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Nested={})}(this,function(t){"use strict";function e(t,e){function n(){this.constructor=t}ee(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function n(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&(n[r[i]]=t[r[i]]);return n}function r(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s}function i(t){if(null===t)return!0;switch(typeof t){case"number":case"string":case"boolean":return!0;case"object":var e=Object.getPrototypeOf(t);if(e===Object.prototype||e===Array.prototype)return p(t,i)}return!1}function o(t){return Object.getPrototypeOf(t.prototype).constructor}function s(t){if(t)for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function a(t,e){for(var n,r=0;r<t.length;r++)if(n=e(t[r],r))return n}function u(t,e){var n;for(var r in t)if(t.hasOwnProperty(r)&&(n=e(t[r],r)))return n}function c(t,e){return Object.getPrototypeOf(t)===oe?a(t,e):u(t,e)}function p(t,e){return!c(t,function(t){return!e(t)})}function h(t){for(var e={},n={},r=1;r<arguments.length;r++)n[arguments[r]]=!0;for(var i in t)!n.hasOwnProperty(i)&&t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function f(t,e,n){for(var r in e)if(e.hasOwnProperty(r)){var i=n(e[r],r);void 0===i||(t[r]=i)}return t}function l(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);if(arguments.length>2)for(var r=2;r<arguments.length;r++){var i=arguments[r];i&&l(t,i)}return t}function d(t,e){for(var n in e)e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n]);if(arguments.length>2)for(var r=2;r<arguments.length;r++){var i=arguments[r];i&&d(t,i)}return t}function v(t){var e,n=!0;return function(){return n&&(n=!1,e=t.apply(this,arguments),t=null),e}}function y(t,e){if(t===e)return!1;if(t&&e&&"object"==typeof t&&"object"==typeof e){var n=Object.getPrototypeOf(t);if(n!==Object.getPrototypeOf(e))return!0;switch(n){case se:return+t!=+e;case oe:return m(t,e);case ae:case null:return g(t,e)}}return!0}function g(t,e){var n=Object.keys(t);if(n.length!==Object.keys(e).length)return!0;for(var r=0;r<n.length;r++){var i=n[r];if(!e.hasOwnProperty(i)||y(t[i],e[i]))return!0}return!1}function m(t,e){if(t.length!==e.length)return!0;for(var n=0;n<t.length;n++)if(y(t[n],e[n]))return!0;return!1}function b(t){var e=Object.create(ue);return t?l(e,t):e}function _(t){var e=o(t);t.__super__=e.prototype,t.define||he.get(pe).populate(t),he.get(t),t.onExtend&&t.onExtend(e)}function O(t){if("function"!=typeof t)return function(e){_(e),e.define(t)};_(t),t.define()}function w(t){return function(e){var n=he.get(e);n.definitionRules=d(b(),t,n.definitionRules)}}function j(t,e){return function(n,r){he.get(n.constructor).mergeObject(n,(i={},i[t]=(o={},o[r]=e,o),i));var i,o}}function C(t,e){for(var n=fe[typeof t],r=0,i=Object.getOwnPropertyNames(t);r<i.length;r++){var o=i[r];n[o]||e(o)}}function A(t,e,n,r,i){if(t.hasOwnProperty(e)){var o=Object.getOwnPropertyDescriptor(t,e);o.configurable&&"value"in o&&(t[e]=i?E(n.value,o.value,r):E(o.value,n.value,r))}else Object.defineProperty(t,e,n)}function E(t,e,n){return void 0===t?e:n&&void 0!==e?n(t,e):t}function P(t){return ge[t]||(ge[t]=function(e,n,r,i,o){void 0===i&&void 0===o||U(this,t,e,n,r,i,o),void 0!==r?B(this,t,e,n,r):M(this,t,e,n)})}function S(t,e,n,r){for(var i,o,s=t[e],a=s;a;a=a.next)n&&n!==a.callback&&n!==a.callback._callback||r&&r!==a.context?(o=a,i||(i=a)):o&&(o.next=a.next);s!==i&&(t[e]=i)}function N(t,e,n){for(var r=t;r;r=r.next)r.callback.call(r.context,e,n)}function x(t,e,n,r){for(var i=t;i;i=i.next)i.callback.call(i.context,e,n,r)}function D(t,e,n,r,i){for(var o=t;o;o=o.next)o.callback.call(o.context,e,n,r,i)}function k(t,e,n,r,i,o){for(var s=t;s;s=s.next)s.callback.call(s.context,e,n,r,i,o)}function T(t,e,n,r,i,o,s){for(var a=t;a;a=a.next)a.callback.call(a.context,e,n,r,i,o,s)}function I(t,e,n,r){if(n){var i=t._events||(t._events=Object.create(null));i[e]=new me(n,r,i[e])}}function R(t,e,n,r){if(n){var i=v(function(){J(t,e,i),n.apply(this,arguments)});i._callback=n,I(t,e,i,r)}}function J(t,e,n,r){var i=t._events;if(i)if(n||r)if(e)S(i,e,n,r);else for(var o in i)S(i,o,n,r);else e?i[e]=void 0:t._events=void 0}function V(t,e,n,r,i){if(be.test(n))for(var o=0,s=n.split(be);o<s.length;o++)t(e,s[o],r,i);else t(e,n,r,i)}function M(t,e,n,r){var i=t._events;if(i){var o=i[e],s=i.all;N(o,n,r),x(s,e,n,r)}}function B(t,e,n,r,i){var o=t._events;if(o){var s=o[e],a=o.all;x(s,n,r,i),D(a,e,n,r,i)}}function U(t,e,n,r,i,o,s){var a=t._events;if(a){var u=a[e],c=a.all;k(u,n,r,i,o,s),T(c,e,n,r,i,o,s)}}function H(){return"l"+Se++}function F(t){if(t)return"function"==typeof t?{get:t}:t}function q(t,e){(t._listeningTo||(t._listeningTo=Object.create(null)))[e.cid||(e.cid=H())]=e}function z(t,e,n){for(var r=e.match(ke),i=r.length-1,o=t,s=0;s<i;s++){var a=r[s];switch(a){case"~":o=o.getStore();break;case"^":o=o.getOwner();break;default:o=o.get(a)}if(!o)return}return n(o,r[i])}function W(t){var e=t.collection;if(e)return W(e);if(t._owner){var n=t._owner._endpoints;return n&&n[t._ownerKey]}}function K(t,e,n,r){return L(t),t._ioPromise=e.then(function(e){t._ioPromise=null;var i=r?r(e):e;return Z(t,"sync",t,e,n),i}).catch(function(e){throw t._ioPromise=null,console.error(e),Z(t,"error",t,e,n),e}),t._ioPromise.abort=e.abort,t._ioPromise}function L(t){t._ioPromise&&t._ioPromise.abort&&(t._ioPromise.abort(),t._ioPromise=null)}function Z(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t.trigger.apply(t,e);var r=t.collection;r&&r.trigger.apply(r,e)}function G(t){var e=t.collection;if(e)return G(e);if(t._owner){var n=t._owner._endpoints;return n&&n[t._ownerKey]}}function $(t,e,n){var r=Q(t),i={};t._attributes[e].doUpdate(n,t,i)&&(X(t,i),Fe(t,"change:"+e,t,t.attributes[e],i)),r&&He(t)}function Q(t){return!!Be(t)&&(t._previousAttributes=new t.AttributesCopy(t.attributes),t._changedAttributes=null,!0)}function X(t,e){return t._changedAttributes&&(t._changedAttributes=null),Ue(t,e)}function Y(t){var e=Object.keys(t),n=new Function("values","\n        "+e.map(function(t){return"\n            this."+t+" = values."+t+";\n        "}).join("")+"\n    ");n.prototype=Object.prototype;var r=new Function("record","values","options","\n        var _attrs = record._attributes;\n\n        "+e.map(function(t){return"\n            this."+t+" = _attrs."+t+".doInit( values."+t+", record, options );\n        "}).join("")+"\n    ");return r.prototype=Object.prototype,{Attributes:r,AttributesCopy:n}}function tt(t,e){return!(!e||e.constructor!==Object)||(t._log("warn","update with non-object is ignored!",{values:e}),!1)}function et(t,e){return function(n,r){return e.call(this,t.call(this,n,r),r)}}function nt(t,e){return function(n,r,i,o){return e.call(this,t.call(this,n,r,i,o),r,i,o)}}function rt(t,e){return function(n,r,i,o){t.call(this,n,r,i,o),e.call(this,n,r,i,o)}}function it(t){return function(e,n,r){return n?t.call(this,e,n,r):"Required"}}function ot(){}function st(t){var e;if("function"==typeof t)e=t.has;else if(t&&t instanceof Ye)e=t;else{var n=at(t);e=n&&n.prototype instanceof Ve?n.shared.value(t):new Ye({type:n,value:t,hasCustomDefault:!0})}return e.options}function at(t){switch(typeof t){case"number":return Number;case"string":return String;case"boolean":return Boolean;case"undefined":return;case"object":return t?t.constructor:void 0}}function ut(t){return!isNaN(new Date(t).getTime())}function ct(t){var e,n,r=0;if(n=sn.exec(t)){for(var i,o=0;i=on[o];++o)n[i]=+n[i]||0;n[2]=(+n[2]||1)-1,n[3]=+n[3]||1,"Z"!==n[8]&&void 0!==n[9]&&(r=60*n[10]+n[11],"+"===n[9]&&(r=0-r)),e=Date.UTC(n[1],n[2],n[3],n[4],n[5]+r,n[6],n[7])}else e=Date.parse(t);return e}function pt(t){return t?Math.round(t):0}function ht(){}function ft(){}function lt(t,e){return Ze.create(st(t),e)}function dt(t){var e=Object.keys(t).filter(function(e){return t[e].parse});return e.length?{_parse:new Function("json","\n            var _attrs = this._attributes;\n\n            "+e.map(function(t){return"                \n                json."+t+" === void 0 || ( json."+t+" = _attrs."+t+".parse.call( this, json."+t+', "'+t+'" ) );\n            '}).join("")+"\n\n            return json;\n        ")}:{}}function vt(t){return new Function("\n        var json = {},\n            v = this.attributes,\n            a = this._attributes;\n\n        "+Object.keys(t).map(function(e){if(t[e].toJSON)return"json."+e+" = a."+e+".toJSON.call( this, v."+e+", '"+e+"' );"}).join("\n")+"\n\n        return json;\n    ")}function yt(t,e){t.hasOwnProperty("shared")||Object.defineProperty(t,"shared",{get:function(){return new Ye({value:null,type:t,_attribute:e})}})}function gt(t){var e;for(var n in t){var r=t[n].options._onChange;r&&(e||(e=new ve),e.addEvent("change:"+n,"string"==typeof r?bt(r,n):mt(r,n)))}return e?{_localEvents:e}:{}}function mt(t,e){return function(n,r){t.call(n,r,e)}}function bt(t,e){var n=new Te(t,!0),r=n.local,i=n.resolve,o=n.tail;return r?function(t,n){t[o](n,e)}:function(t,n){i(t)[o](n,e)}}function _t(t){if(t&&"object"==typeof t)switch(Object.getPrototypeOf(t)){case On:return An;case wn:return Cn}return jn}function Ot(t){return t._links||(t._links=new t.AttributesCopy({}))}function wt(t,e,n){var r=t[n],i=e[n];return r&&r.value===i?r:t[n]=new Rn(e,n,i)}function jt(t,e){if(tt(t,e)){var n=t._attributes,r=void 0;for(var i in e)n[i]||(r||(r=[]),r.push("'"+i+"'"));r&&t._log("warn","undefined attributes "+r.join(", ")+" are ignored.",{values:e})}}function Ct(t){var e=t.defaults,n=t.attributes,r=t.idAttribute,i=n||e||{};return!r||r in i||(i[r]=void 0),i}function At(t){var e=t.models;return t.models=[],t._byId={},St(t,e),e}function Et(e,n,r){var i,o=e.model;e._shared?(i=n instanceof o?n:o.create(n,r),e._shared&t.ItemsBehavior.listen&&Gn(i,i._changeEventName,e._onChildrenChange,e)):(i=n instanceof o?r.merge?n.clone():n:o.create(n,r),Xn(e,i)||(e._aggregationError||(e._aggregationError=[])).push(i));var s=e._itemEvents;return s&&s.subscribe(e,i),i}function Pt(e,n,r){e._shared?e._shared&t.ItemsBehavior.listen&&$n(n,n._changeEventName,e._onChildrenChange,e):(Yn(e,n),r||n.dispose());var i=e._itemEvents;i&&i.unsubscribe(e,n)}function St(t,e){for(var n=0,r=e;n<r.length;n++)Pt(t,r[n]);return e}function Nt(t,e){var n=t._comparator;return!(!n||!1===e.sort)&&(t.models.sort(n),!0)}function xt(t,e){t[e.cid]=e;var n=e.id;null!=n&&(t[n]=e)}function Dt(t,e){delete t[e.cid];var n=e.id;null!=n&&delete t[n]}function kt(t,e){delete t[e.previous(e.idAttribute)];var n=e.id;null==n||(t[n]=e)}function Tt(t){t._log("error","added records already have an owner",t._aggregationError),t._aggregationError=void 0}function It(t,e,n,r){var i=er(t),o=[],s=Vt(t,e,o,n,r);if(s.length||o.length){var a=Rt(t,s,n);if(rr(t,n))return new tr(t,i,s,[],o,a);t._aggregationError&&Tt(t)}i&&nr(t)}function Rt(t,e,n){var r=n.at;if(null!=r){var i=t.models.length-e.length;return(r=Number(r))<0&&(r+=i+1),r<0&&(r=0),r>i&&(r=i),Jt(t.models,r,e),!1}return Nt(t,n)}function Jt(t,e,n){for(var r=t.length-1,i=r-n.length;i>=e;i--,r--)t[r]=t[i];for(i=0,r=e;i<n.length;i++,r++)t[r]=n[i]}function Vt(t,e,n,r,i){for(var o=t._byId,s=t.models,a=(i||r.merge)&&!t._shared,u=(r.parse,t.model.prototype.idAttribute),c=s.length,p=0,h=e;p<h.length;p++){var f=h[p],l=f?o[f[u]]||o[f.cid]:null;if(l){if(a&&f!==l){var d=f.attributes||f,v=l._createTransaction(d,r);v&&n.push(v),l.hasChanged(u)&&kt(o,l)}}else l=Et(t,f,r),s.push(l),xt(o,l)}return s.slice(c)}function Mt(t,e,n,r){var i=ir(t),o=Ft(t,e,n);if(o.length){var s=Nt(t,n);if(sr(t,r?ar:n))return new tr(t,i,o.slice(),[],[],s);t._aggregationError&&Tt(t)}i&&or(t)}function Bt(t,e,n){var r=ir(t),i=[],o=t.models,s=Ht(t,e,i,n),a=t.models.length-s.length,u=a<o.length?a?Ut(t,o):St(t,o):[],c=i.length||s.length,p=Nt(t,n)&&c||s.length||n.sorted;if(c||u.length||p){if(sr(t,n))return new tr(t,r,s,u,i,p);t._aggregationError&&Tt(t)}r&&or(t)}function Ut(t,e){for(var n=t._byId,r=[],i=0,o=e;i<o.length;i++){var s=o[i];n[s.cid]||(r.push(s),Pt(t,s))}return r}function Ht(t,e,n,r){for(var i=Array(e.length),o={},s=(null==r.merge||r.merge)&&!t._shared,a=t._byId,u=t.models,c=t.model.prototype.idAttribute,p=[],h=!0,f=0,l=0;f<e.length;f++){var d=e[f],v=null;if(d){var y=d[c],g=d.cid;if(o[y]||o[g])continue;v=a[y]||a[g]}if(v){if(s&&d!==v){h&&u[l]!==v&&(h=!1);var m=d.attributes||d,b=v._createTransaction(m,r);b&&n.push(b)}}else v=Et(t,d,r),p.push(v);i[l++]=v,xt(o,v)}return i.length=l,t.models=i,t._byId=o,h||(r.sorted=!0),p}function Ft(t,e,n){for(var r=e?e.length:0,i=Array(r),o={},s=t.model.prototype.idAttribute,a=0,u=0;a<r;a++){var c=e[a];if(!c||!o[c[s]]&&!o[c.cid]){var p=Et(t,c,n);i[u++]=p,xt(o,p)}}return i.length=u,t._byId=o,t.models=i}function qt(t,e,n){var r=t.get(e);if(r){var i=hr(t),o=t.models;o.splice(o.indexOf(r),1),Dt(t._byId,r);var s=pr(t,n);return s&&(cr(r,"remove",r,t,n),cr(t,"remove",r,t,n)),Pt(t,r,n.unset),s&&ur(t,"update",t,n),i&&fr(t),r}}function zt(t,e,n){var r=Wt(t,e,n.unset);if(r.length){var i=hr(t);Kt(t,r.length),pr(t,n)?new tr(t,i,[],r,[],!1).commit():i&&fr(t)}return r}function Wt(t,e,n){for(var r=Array(e.length),i=t._byId,o=0,s=0;o<e.length;o++){var a=t.get(e[o]);a&&(r[s++]=a,Dt(i,a),Pt(t,a,n))}return r.length=s,r}function Kt(t,e){for(var n=t.models,r=t.models=Array(n.length-e),i=t._byId,o=0,s=0;o<n.length;o++){var a=n[o];i[a.cid]&&(r[s++]=a)}r.length=s}function Lt(t,e,n){var r=n.parse?t.parse(e,n):e;return Array.isArray(r)?r:[r]}function Zt(t,e){return void 0!==e?function(n,r){return t.call(e,n,r)}:t}function Gt(t,e){return"object"==typeof t?function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0}:Zt(t,e)}function $t(t){switch(typeof t){case"function":return function(e){return t.call(e)};case"object":return function(){return t};case"string":return new Te(t).resolve}}function Qt(t){var n=function(t){function n(e,n){var r=t.call(this,[],n,Ar)||this;return r.resolvedWith=null,r.refs=te(e),r}return e(n,t),Object.defineProperty(n.prototype,"__inner_state__",{get:function(){return this.refs||this.models},enumerable:!0,configurable:!0}),n.prototype.add=function(e,n){var r=this.resolvedWith,i=te(e);if(r)return t.prototype.add.call(this,Xt(r,i),n);if(i.length){var o=Me.begin(this);this.refs=this.refs?this.refs.concat(i):i.slice(),Me.markAsDirty(this,n),o&&Me.commit(this)}},n.prototype.reset=function(e,n){var r=this.resolvedWith,i=te(e);return r?t.prototype.reset.call(this,Xt(r,i),n):Yt(this,i,n)||[]},n.prototype._createTransaction=function(e,n){var r=this.resolvedWith,i=te(e);return r?t.prototype._createTransaction.call(this,Xt(r,i),n):Yt(this,i,n)},n.prototype.toJSON=function(){return this.refs?this.refs.map(function(t){return t.id||t}):this.models.map(function(t){return t.id})},n.prototype._validateNested=function(){return 0},n.prototype.clone=function(t){var e=new(0,this.constructor)([],{model:this.model,comparator:this.comparator});return this.resolvedWith?(e.resolvedWith=this.resolvedWith,e.reset(this.models,{silent:!0})):e.refs=this.refs.slice(),e},n.prototype.parse=function(t){return t},n.prototype.resolve=function(t){return t&&t.length&&(this.resolvedWith=t,this.refs&&(this.reset(this.refs,{silent:!0}),this.refs=null)),this},n.prototype.getModelIds=function(){return this.toJSON()},n.prototype.toggle=function(e,n){return t.prototype.toggle.call(this,this.resolvedWith.get(e),n)},n.prototype.addAll=function(){if(this.resolvedWith)return this.set(this.resolvedWith.models),this.models;throw new Error("Cannot add elemens because the subset collection is not resolved yet.")},n.prototype.toggleAll=function(){return this.length?this.reset():this.addAll()},n=r([O],n)}(t);return n.prototype._itemEvents=void 0,n}function Xt(t,e){for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r],s=t.get(o);s&&n.push(s)}return n}function Yt(t,e,n){if(y(t.refs,e)){var r=Me.begin(t);t.refs=e.slice(),Me.markAsDirty(t,n),r&&Me.commit(t)}}function te(t){return t?Array.isArray(t)?t:[t]:[]}var ee=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},ne=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},re={none:0,error:1,warn:2,info:3,log:4,debug:5},ie=function(t,e,n){var r,i,o,s=re[t];if(void 0!==s||n?(r=e,o=t,i=n):(s=4,r=t,i=e,o="log"),s<=ie.level){if(s<=ie.throw||!ie.logger){var a=new Error(r);throw a.props=i,a}ie.logger(o,r,i),ie.stop}};ie.level="undefined"!=typeof process&&process.env&&"production"===process.env.NODE_ENV?1:2,ie.throw=0,ie.stop=0,"undefined"!=typeof console&&(ie.logger=function(t,e,n){var r=[e];for(var i in n)r.push("\n\t"+i+":",n[i]);console[t].apply(console,r)}),Object.setPrototypeOf||(Object.setPrototypeOf=d);var oe=Array.prototype,se=Date.prototype,ae=Object.prototype,ue=Object.create(null);ue.hasOwnProperty=ae.hasOwnProperty;var ce=Object.freeze({log:ie,isValidJSON:i,getBaseClass:o,assignToClassProto:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];for(var i=0,o=n;i<o.length;i++){var s=o[i],a=e[s];void 0===a||(t.prototype[s]=a)}},isEmpty:s,some:c,every:p,getPropertyDescriptor:function(t,e){for(var n,r=t;!n&&r;r=Object.getPrototypeOf(r))n=Object.getOwnPropertyDescriptor(r,e);return n},omit:h,transform:f,fastAssign:function(t,e){for(var n in e)t[n]=e[n];return t},fastDefaults:function(t,e){for(var n in e)void 0===t[n]&&(t[n]=e[n]);return t},assign:l,defaults:d,keys:function(t){return t?Object.keys(t):[]},once:v,notEqual:y,hashMap:b}),pe=function(){function t(){}return t.define=function(t,e){void 0===t&&(t={});var r=o(this);e&&l(this,e);var i=t.mixins,s=n(t,["mixins"]);return i&&this.mixins.merge(i),this.mixins.mergeObject(this.prototype,s,!0),this.mixins.mergeObject(this.prototype,this.mixins.getStaticDefinitions(r),!0),this.onDefine&&this.onDefine(this.mixins.definitions,r),this.mixins.mergeInheritedMembers(r),this},t.extend=function(t,n){var r;return t&&t.hasOwnProperty("constructor")?e(r=t.constructor,this):r=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n}(this),_(r),t&&r.define(t,n),r},t}(),he=function(){function t(t){this.Class=t,this.definitions={};var e=o(t).mixins;this.mergeRules=e&&e.mergeRules||b(),this.definitionRules=e&&e.definitionRules||b(),this.appliedMixins=e&&e.appliedMixins||[]}return t.get=function(e){var n=e.mixins;return n&&e===n.Class?n:e.mixins=new t(e)},t.prototype.getStaticDefinitions=function(t){var e=b(),n=this.Class;return f(e,this.definitionRules,function(e,r){if(t[r]!==n[r])return n[r]})},t.prototype.merge=function(t){for(var e=this.Class.prototype,n=this.appliedMixins=this.appliedMixins.slice(),r=0,i=t;r<i.length;r++){var s=i[r];if(Array.isArray(s))this.merge(s);else if(n.indexOf(s)<0)if(n.push(s),"function"==typeof s){o(s)!==Object&&console.log("Mixin error"),this.mergeObject(this.Class,s);var a=s.mixins;a&&(this.mergeRules=d(b(),this.mergeRules,a.mergeRules),this.definitionRules=d(b(),this.definitionRules,a.definitionRules),this.appliedMixins=this.appliedMixins.concat(a.appliedMixins)),this.mergeObject(e,s.prototype)}else this.mergeObject(e,s)}},t.prototype.populate=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=0,i=e;r<i.length;r++)t.get(i[r]).merge([this.Class])},t.prototype.mergeObject=function(t,e,n){var r=this;C(e,function(i){var o,s=Object.getOwnPropertyDescriptor(e,i);(o=r.definitionRules[i])&&A(r.definitions,i,s,o,n),o&&o!==de.protoValue||A(t,i,s,r.mergeRules[i],n)})},t.prototype.mergeInheritedMembers=function(t){var e=this,n=e.mergeRules,r=e.Class;if(n){var i=r.prototype,o=t.prototype;for(var s in n){var a=n[s];i.hasOwnProperty(s)&&s in o&&(i[s]=E(i[s],o[s],a))}}},t}(),fe={function:b({length:!0,prototype:!0,caller:!0,arguments:!0,name:!0,__super__:!0}),object:b({constructor:!0})},le=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return he.get(e).merge(t)}},de=function(t){return function(e){var n=he.get(e);n.mergeRules=d(t,n.mergeRules)}};de.value=function(t,e){return t},de.protoValue=function(t,e){return t},de.merge=function(t,e){return d({},t,e)},de.pipe=function(t,e){return function(n){return t.call(this,e.call(this,n))}},de.defaults=function(t,e){return function(){return d(t.apply(this,arguments),e.apply(this,arguments))}},de.classFirst=function(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}},de.classLast=function(t,e){return function(){e.apply(this,arguments),t.apply(this,arguments)}},de.every=function(t,e){return function(){return t.apply(this,arguments)&&e.apply(this,arguments)}},de.some=function(t,e){return function(){return t.apply(this,arguments)||e.apply(this,arguments)}};var ve=function(){function t(e){this.handlers=[],e&&(e instanceof t?this.handlers=e.handlers.slice():e&&this.addEventsMap(e))}return t.prototype.merge=function(t){this.handlers=this.handlers.concat(t.handlers)},t.prototype.addEventsMap=function(t){for(var e in t)this.addEvent(e,t[e])},t.prototype.bubbleEvents=function(t){for(var e=0,n=t.split(be);e<n.length;e++){var r=n[e];this.addEvent(r,P(r))}},t.prototype.addEvent=function(t,e){for(var n=this.handlers,r=0,i=t.split(be);r<i.length;r++){var o=i[r];n.push(new ye(o,e))}},t.prototype.subscribe=function(t,e){for(var n=0,r=this.handlers;n<r.length;n++){var i=r[n];I(e,i.name,i.callback,t)}},t.prototype.unsubscribe=function(t,e){for(var n=0,r=this.handlers;n<r.length;n++){var i=r[n];J(e,i.name,i.callback,t)}},t}(),ye=function(){return function(t,e){this.name=t,this.callback=!0===e?P(t):"string"==typeof e?function(){var t=this[e];t&&t.apply(this,arguments)}:e}}(),ge={},me=function(){return function(t,e,n){void 0===n&&(n=null),this.callback=t,this.context=e,this.next=n}}(),be=/\s+/,_e=Object.freeze({EventMap:ve,EventDescriptor:ye,EventHandler:me,on:I,once:R,off:J,strings:V,trigger2:M,trigger3:B,trigger5:U}),Oe=V,we=I,je=J,Ce=R,Ae=U,Ee=M,Pe=B,Se=0,Ne=function(){function t(){this._events=void 0,this._listeningTo=void 0,this.cid=H(),this.initialize.apply(this,arguments)}return t.onDefine=function(t,e){var n=t.localEvents,r=t._localEvents,i=t.properties;if(n||r){var o=new ve(this.prototype._localEvents);n&&o.addEventsMap(n),r&&o.merge(r),this.prototype._localEvents=o}i&&Object.defineProperties(this.prototype,f({},i,F))},t.prototype.initialize=function(){},t.prototype.on=function(t,e,n){if("string"==typeof t)Oe(we,this,t,e,n);else for(var r in t)Oe(we,this,r,t[r],n||e);return this},t.prototype.once=function(t,e,n){if("string"==typeof t)Oe(Ce,this,t,e,n);else for(var r in t)Oe(Ce,this,r,t[r],n||e);return this},t.prototype.off=function(t,e,n){if(t)if("string"==typeof t)Oe(je,this,t,e,n);else for(var r in t)Oe(je,this,r,t[r],n||e);else je(this,void 0,e,n);return this},t.prototype.trigger=function(t,e,n,r,i,o){return void 0!==i||void 0!==o?Ae(this,t,e,n,r,i,o):void 0!==r?Pe(this,t,e,n,r):Ee(this,t,e,n),this},t.prototype.listenTo=function(t,e,n){return t&&(q(this,t),t.on(e,n||"object"!=typeof e?n:this,this)),this},t.prototype.listenToOnce=function(t,e,n){return t&&(q(this,t),t.once(e,n||"object"!=typeof e?n:this,this)),this},t.prototype.stopListening=function(t,e,n){var r=this._listeningTo;if(r){var i=!(e||n),o=n||"object"!=typeof e?n:this;if(t){var s=r[t.cid];s&&(i&&delete r[t.cid],s.off(e,o,this))}else if(null==t){for(var a in r)r[a].off(e,o,this);i&&(this._listeningTo=void 0)}}return this},t.prototype.dispose=function(){this._disposed||(this.stopListening(),this.off(),this._disposed=!0)},t=r([O,w({properties:de.merge,localEvents:de.merge})],t)}(),xe=h(Ne.prototype,"constructor","initialize");Object.extend=function(t,e){return pe.extend(t,e)},Object.assign||(Object.assign=l),Object.log=ie;var De=function(){function t(t){this.length=t._validateNested(this.nested={}),(this.error=t.validate(t))&&this.length++}return t.prototype.each=function(t){var e=this,n=e.error,r=e.nested;n&&t(n,null);for(var i in r)t(r[i],i)},t.prototype.eachError=function(e,n){this.each(function(r,i){r instanceof t?r.eachError(e,n.get(i)):e(r,i,n)})},t}(),ke=/\^|([^.]+)/g,Te=function(){return function(t,e){void 0===e&&(e=!1);var n=t.match(ke).map(function(t){return"^"===t?"getOwner()":"~"===t[0]?'getStore().get("'+t.substr(1)+'")':t});this.tail=e&&n.pop(),this.local=!n.length,n.unshift("self"),this.resolve=new Function("self","return "+n.join(".")+";")}}(),Ie=B,Re=I,Je=J;!function(t){t[t.share=1]="share",t[t.listen=2]="listen",t[t.persistent=4]="persistent"}(t.ItemsBehavior||(t.ItemsBehavior={}));var Ve=function(){function t(t){this._events=void 0,this._changeToken={},this._transaction=!1,this._isDirty=null,this._owner=void 0,this._ownerKey=void 0,this._validationError=void 0,this.cid=this.cidPrefix+t}return e=t,t.onDefine=function(t,e){t.endpoint&&(this.prototype._endpoint=t.endpoint),Ne.onDefine.call(this,t,e)},t.onExtend=function(t){t.create===this.create&&(this.create=e.create)},t.create=function(t,e){return new this(t,e)},t.prototype.dispose=function(){this._disposed||(L(this),this._owner=void 0,this._ownerKey=void 0,this.off(),this.stopListening(),this._disposed=!0)},t.prototype.initialize=function(){},t.prototype.onChanges=function(t,e){Re(this,this._changeEventName,t,e)},t.prototype.offChanges=function(t,e){Je(this,this._changeEventName,t,e)},t.prototype.listenToChanges=function(t,e){this.listenTo(t,t._changeEventName,e)},t.prototype.transaction=function(t,e){void 0===e&&(e={});var n=Me.begin(this),r=t.call(this,this);r&&this.set(r),n&&Me.commit(this)},t.prototype.updateEach=function(t,e){var n=Me.begin(this);this.each(t),n&&Me.commit(this)},t.prototype.set=function(t,e){if(t){var n=this._createTransaction(t,e);n&&n.commit()}return this},t.prototype.assignFrom=function(t){return this.set(t.__inner_state__||t,{merge:!0})},t.prototype.parse=function(t,e){return t},t.prototype.deepGet=function(t){return z(this,t,function(t,e){return t.get?t.get(e):t[e]})},t.prototype.getOwner=function(){return this._owner},t.prototype.getStore=function(){var t=this._owner;return t?t.getStore():this._defaultStore},t.prototype.map=function(t,e){var n=[],r=void 0!==e?function(n,r){return t.call(e,n,r)}:t;return this.each(function(t,e){var i=r(t,e);void 0!==i&&n.push(i)}),n},t.prototype.fetch=function(t){throw new Error("Not implemented")},t.prototype.getEndpoint=function(){return G(this)||this._endpoint},t.prototype.mapObject=function(t,e){var n={};return this.each(function(e,r){var i=t(e,r);void 0!==i&&(n[r]=i)}),n},Object.defineProperty(t.prototype,"validationError",{get:function(){var t=this._validationError||(this._validationError=new De(this));return t.length?t:null},enumerable:!0,configurable:!0}),t.prototype.validate=function(t){},t.prototype.getValidationError=function(t){var e=this.validationError;return(t?e&&e.nested[t]:e)||null},t.prototype.deepValidationError=function(t){return z(this,t,function(t,e){return t.getValidationError(e)})},t.prototype.eachValidationError=function(t){var e=this.validationError;e&&e.eachError(t,this)},t.prototype.isValid=function(t){return!this.getValidationError(t)},t.prototype.valueOf=function(){return this.cid},t.prototype.toString=function(){return this.cid},t.prototype.getClassName=function(){var t=this.constructor.name;if("Subclass"!==t)return t},t=e=r([O,w({endpoint:de.value}),le(Ne)],t);var e}(),Me={begin:function(t){return!t._transaction&&(t._transaction=!0)},markAsDirty:function(t,e){var n=!e.silent;return n&&(t._isDirty=e),t._changeToken={},t._validationError=void 0,n},commit:function(t,e){var n=t._isDirty;if(n){for(;t._isDirty;){var r=t._isDirty;t._isDirty=null,Ie(t,t._changeEventName,t,r,e)}t._transaction=!1;var i=t._owner;i&&i!==e&&i._onChildrenChange(t,n)}else t._isDirty=null,t._transaction=!1},aquire:function(t,e,n){return e._owner?e._owner===t:(e._owner=t,e._ownerKey=n,!0)},free:function(t,e){t===e._owner&&(e._owner=void 0,e._ownerKey=void 0)}},Be=Me.begin,Ue=Me.markAsDirty,He=Me.commit,Fe=B,qe={transaction:function(t,e){void 0===e&&(e={});var n=Q(this);t.call(this,this),n&&He(this)},_onChildrenChange:function(t,e){var n=t._ownerKey,r=this._attributes[n];r&&!r.propagateChanges||this.forceAttributeChange(n,e)},forceAttributeChange:function(t,e){void 0===e&&(e={});var n=Q(this);X(this,e)&&Fe(this,"change:"+t,this,this.attributes[t],e),n&&He(this)},_createTransaction:function(t,e){void 0===e&&(e={});var n,r=Q(this),i=[],o=[],s=this._attributes,a=e.parse?this.parse(t,e):t;if(tt(this,a))for(var u in a){var c=s[u];c?c.doUpdate(a[u],this,e,o)&&i.push(u):(n||(n=[]),n.push("'"+u+"'"))}if(i.length&&X(this,e))return new ze(this,r,o,i);for(var p=0,h=o;p<h.length;p++)h[p].commit(this);r&&He(this)}},ze=function(){function t(t,e,n,r){this.object=t,this.isRoot=e,this.nested=n,this.changes=r}return t.prototype.commit=function(t){for(var e=this,n=e.nested,r=e.object,i=e.changes,o=0,s=n;o<s.length;o++)s[o].commit(r);for(var a=r.attributes,u=r._isDirty,c=0,p=i;c<p.length;c++){var h=p[c];Fe(r,"change:"+h,r,a[h],u)}this.isRoot&&He(r,t)},t}(),We=y,Ke=l,Le={},Ze=function(){function t(t,e){this.name=t,this.getHook=null,this.options=e;var n=Ke({getHooks:[],transforms:[],changeHandlers:[]},e);n.getHooks=n.getHooks.slice(),n.transforms=n.transforms.slice(),n.changeHandlers=n.changeHandlers.slice();var r=n.value,o=n.type,s=n.parse,a=n.toJSON,u=n.changeEvents,c=n.validate,p=n.getHooks,h=n.transforms,f=n.changeHandlers;if(this.value=r,this.type=o,!n.hasCustomDefault&&o?this.defaultValue=this.create:i(r)?this.defaultValue=new Function("return "+JSON.stringify(r)+";"):this.defaultValue=this.defaultValue,this.propagateChanges=!1!==u,this.toJSON=void 0===a?this.toJSON:a,this.validate=c||this.validate,n.isRequired&&(this.validate=it(this.validate)),h.unshift(this.convert),this.parse=s||this.parse,this.get&&p.unshift(this.get),this.initialize.call(this,n),p.length){var l=this.getHook=p.reduce(et),d=this.validate;this.validate=function(t,e,n){return d.call(this,t,l.call(t,e,n),n)}}this.transform=h.length?h.reduce(nt):this.transform,this.handleChange=f.length?f.reduce(rt):this.handleChange}return t.create=function(e,n){var r=e.type;return new(e._attribute||(r?r._attribute:t))(n,e)},t.prototype.canBeUpdated=function(t,e,n){},t.prototype.transform=function(t,e,n,r){return t},t.prototype.convert=function(t,e,n,r){return t},t.prototype.isChanged=function(t,e){return We(t,e)},t.prototype.handleChange=function(t,e,n,r){},t.prototype.create=function(){},t.prototype.clone=function(t,e){return t},t.prototype.dispose=function(t,e){this.handleChange(void 0,e,t,Le)},t.prototype.validate=function(t,e,n){},t.prototype.toJSON=function(t,e){return t&&t.toJSON?t.toJSON():t},t.prototype.createPropertyDescriptor=function(){var t=this,e=t.name,n=t.getHook;if("id"!==e)return{set:function(t){$(this,e,t)},get:n?function(){return n.call(this,this.attributes[e],e)}:function(){return this.attributes[e]}}},t.prototype.initialize=function(t,e){},t.prototype.doInit=function(t,e,n){var r=void 0===t?this.defaultValue():t,i=this.transform(r,void 0,e,n);return this.handleChange(i,void 0,e,n),i},t.prototype.doUpdate=function(t,e,n,r){var i=this.name,o=e.attributes,s=o[i],a=this.transform(t,s,e,n);return o[i]=a,!!this.isChanged(a,s)&&(this.handleChange(a,s,e,n),!0)},t.prototype._log=function(t,e,n,r){ie(t,"[Attribute Update Error] "+r.getClassName()+"."+this.name+": "+e,{Record:r,"Attribute definition":this,"Prev. value":r.attributes[this.name],"New value":n})},t.prototype.defaultValue=function(){return this.value},t}(),Ge=Me.free,$e=Me.aquire,Qe=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return e(r,n),r.prototype.clone=function(t){return t?t.clone():t},r.prototype.toJSON=function(t){return t&&t.toJSON()},r.prototype.doInit=function(t,e,n){var r=n.clone?this.clone(t):void 0===t?this.defaultValue():t,i=this.transform(r,void 0,e,n);return this.handleChange(i,void 0,e,n),i},r.prototype.doUpdate=function(t,e,n,r){var i,o=this.name,s=e.attributes,a=s[o];if(i=this.canBeUpdated(a,t,n)){var u=a._createTransaction(i,n);return!(!u||(r?r.push(u):u.commit(e),!this.propagateChanges))}var c=this.transform(t,a,e,n);return s[o]=c,!!this.isChanged(c,a)&&(this.handleChange(c,a,e,n),!0)},r.prototype.canBeUpdated=function(t,e,n){if(t&&null!=e){if(!(e instanceof this.type))return e;if(n.merge)return e.__inner_state__}},r.prototype.convert=function(e,n,r,i){return null==e?e:e instanceof this.type?(!e._shared||e._shared&t.ItemsBehavior.persistent||this._log("error","aggregated collection attribute is assigned with shared collection",e,r),i.merge?e.clone():e):this.type.create(e,i)},r.prototype.dispose=function(t,e){e&&this.handleChange(void 0,e,t,{})},r.prototype.validate=function(t,e){var n=e&&e.validationError;if(n)return n},r.prototype.create=function(){return this.type.create()},r.prototype.initialize=function(t){t.changeHandlers.unshift(this._handleChange)},r.prototype._handleChange=function(t,e,n,r){e&&(Ge(n,e),r.unset||e.dispose()),t&&!$e(n,t,this.name)&&this._log("error","aggregated attribute assigned with object already having an owner",t,n)},r}(Ze),Xe=l,Ye=function(){function t(t){this.options={getHooks:[],transforms:[],changeHandlers:[]},t&&Xe(this.options,t)}return t.prototype.check=function(t,e){function n(n,r,i){if(!t.call(n,r,i)){var o=e||t.error||i+" is not valid";return"function"==typeof o?o.call(n,i):o}}var r=this.options.validate;return this.metadata({validate:r?function(t,e,i){return r(t,e,i)||n(t,e,i)}:n})},Object.defineProperty(t.prototype,"asProp",{get:function(){return j("attributes",this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRequired",{get:function(){return this.metadata({isRequired:!0})},enumerable:!0,configurable:!0}),t.prototype.endpoint=function(t){return this.metadata({endpoint:t})},t.prototype.watcher=function(t){return this.metadata({_onChange:t})},t.prototype.parse=function(t){return this.metadata({parse:t})},t.prototype.toJSON=function(t){return this.metadata({toJSON:"function"==typeof t?t:t?function(t){return t&&t.toJSON()}:ot})},t.prototype.get=function(t){return this.metadata({getHooks:this.options.getHooks.concat(t)})},t.prototype.set=function(t){return this.metadata({transforms:this.options.transforms.concat(function(e,n,r,i){if(this.isChanged(e,n)){var o=t.call(r,e,this.name);return void 0===o?n:this.convert(o,n,r,i)}return n})})},t.prototype.changeEvents=function(t){return this.metadata({changeEvents:t})},t.prototype.events=function(t){var e=new ve(t);return this.metadata({changeHandlers:this.options.changeHandlers.concat(function(t,n,r){n&&n.trigger&&e.unsubscribe(r,n),t&&t.trigger&&e.subscribe(r,t)})})},Object.defineProperty(t.prototype,"has",{get:function(){return this},enumerable:!0,configurable:!0}),t.prototype.metadata=function(e){var n=new t(this.options);return Xe(n.options,e),n},t.prototype.value=function(t){return this.metadata({value:t,hasCustomDefault:!0})},t}();Function.prototype.value=function(t){return new Ye({type:this,value:t,hasCustomDefault:!0})},Object.defineProperty(Function.prototype,"isRequired",{get:function(){return this._isRequired||this.has.isRequired},set:function(t){this._isRequired=t}}),Object.defineProperty(Function.prototype,"asProp",{get:function(){return this.has.asProp}}),Object.defineProperty(Function.prototype,"has",{get:function(){return this._has||new Ye({type:this,value:this._attribute.defaultValue,hasCustomDefault:void 0!==this._attribute.defaultValue})},set:function(t){this._has=t}});var tn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.create=function(){return new Date},n.prototype.convert=function(t,e,n){if(null==t||t instanceof Date)return t;var r=new Date(t),i=r.getTime();return i!==i&&this._log("warn","assigned with Invalid Date",t,n),r},n.prototype.validate=function(t,e,n){if(null!=e){var r=e.getTime();if(r!==r)return n+" is Invalid Date"}},n.prototype.toJSON=function(t){return t&&t.toISOString()},n.prototype.isChanged=function(t,e){return(t&&t.getTime())!==(e&&e.getTime())},n.prototype.doInit=function(t,e,n){return this.transform(void 0===t?this.defaultValue():t,void 0,e,n)},n.prototype.doUpdate=function(t,e,n,r){var i=this.name,o=e.attributes,s=o[i];return this.isChanged(s,o[i]=this.transform(t,s,e,n))},n.prototype.clone=function(t){return t&&new Date(t.getTime())},n.prototype.dispose=function(){},n}(Ze);Date._attribute=tn;var en=/\/Date\(([0-9]+)\)\//,nn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.convert=function(t){if("string"==typeof t){var e=en.exec(t);if(e)return new Date(Number(e[1]))}return tn.prototype.convert.apply(this,arguments)},n.prototype.toJSON=function(t){return t&&"/Date("+t.getTime()+")/"},n}(tn),rn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.toJSON=function(t){return t&&t.getTime()},n}(tn);Object.defineProperties(Date,{microsoft:{get:function(){return new Ye({type:Date,_attribute:nn})}},timestamp:{get:function(){return new Ye({type:Date,_attribute:rn})}}}),ut("2011-11-29T15:52:30.5")&&ut("2011-11-29T15:52:30.52")&&ut("2011-11-29T15:52:18.867")&&ut("2011-11-29T15:52:18.867Z")&&ut("2011-11-29T15:52:18.867-03:30")||(tn.prototype.convert=function(t){return null==t||t instanceof Date?t:new Date(ct(t))});var on=[1,4,5,6,7,10,11],sn=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/,an=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.create=function(){return new this.type},n.prototype.convert=function(t){return null==t||t instanceof this.type?t:new this.type(t)},n.prototype.toJSON=function(t){return t&&t.toJSON?t.toJSON():t},n.prototype.clone=function(t){return new this.type(this.toJSON(t))},n.prototype.isChanged=function(t,e){return t!==e},n}(Ze);Function.prototype._attribute=an;var un=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.dispose=function(){},n.prototype.create=function(){return this.type()},n.prototype.toJSON=function(t){return t},n.prototype.convert=function(t){return null==t?t:this.type(t)},n.prototype.isChanged=function(t,e){return t!==e},n.prototype.clone=function(t){return t},n.prototype.doInit=function(t,e,n){return this.transform(void 0===t?this.value:t,void 0,e,n)},n.prototype.doUpdate=function(t,e,n,r){var i=this.name,o=e.attributes,s=o[i];return s!==(o[i]=this.transform(t,s,e,n))},n.prototype.initialize=function(){this.options.hasCustomDefault||(this.value=this.type())},n}(Ze);Boolean._attribute=String._attribute=un;var cn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.create=function(){return 0},n.prototype.convert=function(t,e,n){var r=null==t?t:this.type(t);return r!==r&&this._log("warn","assigned with Invalid Number",t,n),r},n.prototype.validate=function(t,e,n){if(null!=e&&!isFinite(e))return n+" is not valid number"},n}(un);Number._attribute=cn,pt._attribute=cn,Number.integer=pt,"undefined"!=typeof window&&(window.Integer=Number.integer);var pn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.toJSON=function(t){return t},n.prototype.dispose=function(){},n.prototype.create=function(){return[]},n.prototype.convert=function(t,e,n){return null==t||Array.isArray(t)?t:(this._log("warn","assignment of non-array to Array attribute is ignored",t,n),[])},n.prototype.clone=function(t){return t&&t.slice()},n}(Ze);Array._attribute=pn;var hn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.create=function(){return{}},n.prototype.convert=function(t,e,n){return null==t||"object"==typeof t?t:(this._log("warn","assignment of non-object to Object attribute is ignored",t,n),{})},n}(Ze);Object._attribute=hn;var fn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.toJSON=function(t){},n.prototype.create=function(){return ht},n.prototype.dispose=function(){},n.prototype.convert=function(t,e,n){return null==t||"function"==typeof t?t:(this._log("warn","assigned with non-function",t,n),ht)},n.prototype.clone=function(t){return t},n}(Ze);Function._attribute=fn;var ln=I,dn=J,vn=Me.free,yn=Me.aquire,gn=t.ItemsBehavior.listen|t.ItemsBehavior.share,mn=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.doInit=function(t,e,n){var r=n.clone?this.clone(t,e):void 0===t?this.defaultValue():t,i=this.transform(r,void 0,e,n);return this.handleChange(i,void 0,e,n),i},n.prototype.doUpdate=function(t,e,n,r){var i,o=this.name,s=e.attributes,a=s[o];if(i=this.canBeUpdated(a,t,n)){var u=a._createTransaction(i,n);return!(!u||(r?r.push(u):u.commit(e),!this.propagateChanges))}var c=this.transform(t,a,e,n);return s[o]=c,!!this.isChanged(c,a)&&(this.handleChange(c,a,e,n),!0)},n.prototype.clone=function(t,e){if(!t||t._owner!==e)return t;var n=t.clone();return yn(e,n,this.name),n},n.prototype.toJSON=function(){},n.prototype.canBeUpdated=function(t,e,n){if(t&&null!=e&&!(e instanceof this.type))return e},n.prototype.convert=function(t,e,n,r){if(null==t||t instanceof this.type)return t;var i=new this.type(t,r,gn);return yn(n,i,this.name),i},n.prototype.validate=function(t,e,n){},n.prototype.create=function(){return null},n.prototype._handleChange=function(t,e,n,r){e&&(e._owner===n?(vn(n,e),r.unset||e.dispose()):dn(e,e._changeEventName,this._onChange,n)),t&&t._owner!==n&&ln(t,t._changeEventName,this._onChange,n)},n.prototype.dispose=function(t,e){e&&this.handleChange(void 0,e,t,{})},n.prototype.initialize=function(t){var e=this;this._onChange=this.propagateChanges?function(t,n,r){this===r||this.forceAttributeChange(e.name,n)}:ft,t.changeHandlers.unshift(this._handleChange)},n}(Ze),bn=function(t,e){var n=f({},t,lt),r=d({},n,e),i=Y(r);return ne({},i,{_attributes:new i.AttributesCopy(r),_attributesArray:Object.keys(r).map(function(t){return r[t]}),properties:f({},n,function(t){return t.createPropertyDescriptor()}),_toJSON:vt(r)},dt(r),gt(n),{_endpoints:f({},r,function(t){return t.options.endpoint})})},_n={getEndpoint:function(){return W(this)||this._endpoint},save:function(t){var e=this;void 0===t&&(t={});var n=this.getEndpoint(),r=this.toJSON();return K(this,this.isNew()?n.create(r,t,this):n.update(this.id,r,t,this),t,function(n){e.set(n,ne({parse:!0},t))})},fetch:function(t){var e=this;return void 0===t&&(t={}),K(this,this.getEndpoint().read(this.id,t,this),t,function(n){return e.set(n,ne({parse:!0},t))})},destroy:function(t){var e=this;return void 0===t&&(t={}),K(this,this.getEndpoint().destroy(this.id,t,this),t,function(){var n=e.collection;n?n.remove(e,t):e.dispose()})}},On=Array.prototype,wn=Object.prototype,jn={clone:function(t){return t},map:function(t,e){return[]},remove:function(t){return t}},Cn={map:function(t,e){var n=[];for(var r in t.value){var i=e(t.at(r),r);void 0===i||n.push(i)}return n},remove:function(t,e){return delete t[e],t},clone:function(t){var e={};for(var n in t)e[n]=t[n];return e}},An={clone:function(t){return t.slice()},remove:function(t,e){return t.splice(e,1),t},map:function(t,e){for(var n=t.value.length,r=Array(n),i=0,o=0;i<n;i++){var s=e(t.at(i),i);void 0===s||(r[o++]=s)}return r.length===o||(r.length=o),r}},En=function(){function t(t){this.value=t}return t.value=function(t,e){return new Pn(t,e)},Object.defineProperty(t.prototype,"validationError",{get:function(){return this.error},enumerable:!0,configurable:!0}),t.prototype.onChange=function(t){var e=this;return new Sn(this,function(n){t(n),e.set(n)})},Object.defineProperty(t.prototype,"props",{get:function(){var t=this;return"boolean"==typeof this.value?{checked:this.value,onChange:function(e){return t.set(Boolean(e.target.checked))}}:{value:this.value,onChange:function(e){return t.set(e.target.value)}}},enumerable:!0,configurable:!0}),t.prototype.requestChange=function(t){this.set(t)},t.prototype.update=function(t,e){var n=t(this.clone(),e);void 0===n||this.set(n)},t.prototype.pipe=function(t){var e=this;return new Sn(this,function(n){var r=t(n,e.value);void 0===r||e.set(r)})},t.prototype.action=function(t){var e=this;return function(n){return e.update(t,n)}},t.prototype.equals=function(t){return new Nn(this,t)},t.prototype.enabled=function(t){return new xn(this,t||"")},t.prototype.contains=function(t){return new Dn(this,t)},t.prototype.push=function(){var t=An.clone(this.value);Array.prototype.push.apply(t,arguments),this.set(t)},t.prototype.unshift=function(){var t=An.clone(this.value);Array.prototype.unshift.apply(t,arguments),this.set(t)},t.prototype.splice=function(){var t=An.clone(this.value);Array.prototype.splice.apply(t,arguments),this.set(t)},t.prototype.map=function(t){return _t(this.value).map(this,t)},t.prototype.removeAt=function(t){var e=this.value,n=_t(e);this.set(n.remove(n.clone(e),t))},t.prototype.at=function(t){return new Tn(this,t)},t.prototype.clone=function(){var t=this.value;return _t(t).clone(t)},t.prototype.pick=function(){for(var t={},e=0;e<arguments.length;e++){var n=arguments[e];t[n]=new Tn(this,n)}return t},t.prototype.check=function(t,e){return this.error||t(this.value)||(this.error=e||t.error||kn),this},t}(),Pn=function(t){function n(e,n){var r=t.call(this,e)||this;return r.set=n,r}return e(n,t),n.prototype.set=function(t){},n}(En),Sn=function(t){function n(e,n){var r=t.call(this,e.value)||this;r.set=n;var i=e.error;return i&&(r.error=i),r}return e(n,t),n.prototype.set=function(t){},n}(En),Nn=function(t){function n(e,n){var r=t.call(this,e.value===n)||this;return r.parent=e,r.truthyValue=n,r}return e(n,t),n.prototype.set=function(t){this.parent.set(t?this.truthyValue:null)},n}(En),xn=function(t){function n(e,n){var r=t.call(this,null!=e.value)||this;return r.parent=e,r.defaultValue=n,r}return e(n,t),n.prototype.set=function(t){this.parent.set(t?this.defaultValue:null)},n}(En),Dn=function(t){function n(e,n){var r=t.call(this,e.value.indexOf(n)>=0)||this;return r.parent=e,r.element=n,r}return e(n,t),n.prototype.set=function(t){var e=this,n=Boolean(t);if(this.value!==n){var r=this.parent.value,i=t?r.concat(this.element):r.filter(function(t){return t!==e.element});this.parent.set(i)}},n}(En),kn="Invalid value",Tn=function(t){function n(e,n){var r=t.call(this,e.value[n])||this;return r.parent=e,r.key=n,r}return e(n,t),n.prototype.remove=function(){this.parent.removeAt(this.key)},n.prototype.set=function(t){var e=this;this.value!==t&&this.parent.update(function(n){return n[e.key]=t,n})},n}(En),In={linkAt:function(t){return wt(Ot(this),this,t)},linkPath:function(t,e){return new Jn(this,t,e)},linkAll:function(){var t=Ot(this);if(arguments.length)for(var e=0;e<arguments.length;e++)wt(t,this,arguments[e]);else{var n=this.attributes;for(var r in n)void 0===n[r]||wt(t,this,r)}return t}},Rn=function(t){function n(e,n,r){var i=t.call(this,r)||this;return i.record=e,i.attr=n,i}return e(n,t),n.prototype.set=function(t){this.record[this.attr]=t},Object.defineProperty(n.prototype,"error",{get:function(){return void 0===this._error?this.record.getValidationError(this.attr):this._error},set:function(t){this._error=t},enumerable:!0,configurable:!0}),n}(En),Jn=function(t){function n(e,n,r){var i=t.call(this,e.deepGet(n))||this;return i.record=e,i.path=n,i.options=r,i}return e(n,t),Object.defineProperty(n.prototype,"error",{get:function(){return void 0===this._error&&(this._error=this.record.deepValidationError(this.path)||null),this._error},set:function(t){this._error=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"_changeToken",{get:function(){return this.record._changeToken},enumerable:!0,configurable:!0}),n.prototype.set=function(t){this.record.deepSet(this.path,t,this.options)},n}(En),Vn=l,Mn=s,Bn=ie,Un=0,Hn=function(t){function n(e,n){var r=t.call(this,Un++)||this;r._links=void 0,r.attributes={};var i=n||{},o=(i.parse?r.parse(e,i):e)||{};return Bn.level>1&&jt(r,o),r._previousAttributes=r.attributes=new r.Attributes(r,o,i),r.initialize(e,n),r._localEvents&&r._localEvents.subscribe(r,r),r}return e(n,t),n,n.onDefine=function(t,e){},n.defaults=function(t){return this.extend({attributes:t})},n.prototype.previousAttributes=function(){return new this.AttributesCopy(this._previousAttributes)},Object.defineProperty(n.prototype,"__inner_state__",{get:function(){return this.attributes},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"changed",{get:function(){var t=this._changedAttributes;if(!t){var e=this._previousAttributes;t={};for(var n=this,r=(n._attributes,n.attributes),i=0,o=this._attributesArray;i<o.length;i++){var s=o[i],a=s.name,u=r[a];s.isChanged(u,e[a])&&(t[a]=u)}this._changedAttributes=t}return t},enumerable:!0,configurable:!0}),n.prototype.changedAttributes=function(t){if(!t)return!!this.hasChanged()&&Vn({},this.changed);var e,n=!1,r=this._transaction?this._previousAttributes:this.attributes,i=this._attributes;for(var o in t)i[o].isChanged(r[o],e=t[o])&&((n||(n={}))[o]=e);return n},n.prototype.hasChanged=function(t){var e=this._previousAttributes;return!!e&&(t?this._attributes[t].isChanged(this.attributes[t],e[t]):!Mn(this.changed))},n.prototype.previous=function(t){if(t){var e=this._previousAttributes;if(e)return e[t]}return null},n.prototype.isNew=function(){return null==this.id},n.prototype.has=function(t){return void 0!=this[t]},n.prototype.unset=function(t,e){var n=this[t];return this.set((r={},r[t]=void 0,r),ne({unset:!0},e)),n;var r},n.prototype.clear=function(t){var e=this,n=t&&t.nullify;return this.transaction(function(){e.forEachAttr(e.attributes,function(t,r){return e[r]=n?null:void 0})},t),this},n.prototype.getOwner=function(){var t=this._owner;return this._ownerKey?t:t&&t._owner},Object.defineProperty(n.prototype,"id",{get:function(){return this.attributes[this.idAttribute]},set:function(t){$(this,this.idAttribute,t)},enumerable:!0,configurable:!0}),n.prototype.forEachAttr=function(t,e){var n,r=this._attributes;for(var i in t){var o=r[i];o?e(t[i],i,o):(n||(n=[]),n.push("'"+i+"'"))}n&&this._log("warn","attributes "+n.join(", ")+" are not defined",{attributes:t})},n.prototype.each=function(t,e){var n=void 0!==e?function(n,r){return t.call(e,n,r)}:t,r=this.attributes;for(var i in this.attributes){var o=r[i];void 0!==o&&n(o,i)}},n.prototype.keys=function(){var t=[];return this.each(function(e,n){return void 0===e||t.push(n)}),t},n.prototype.values=function(){return this.map(function(t){return t})},n.prototype._toJSON=function(){return{}},n.prototype._parse=function(t){return t},n.prototype.defaults=function(t){void 0===t&&(t={});for(var e={},n=0,r=this._attributesArray;n<r.length;n++){var i=r[n],o=i.name,s=t[o];e[o]=void 0===s?i.defaultValue():s}return e},n.prototype.initialize=function(t,e){},n.prototype.clone=function(t){void 0===t&&(t={});var e=new this.constructor(this.attributes,{clone:!0});return t.pinStore&&(e._defaultStore=this.getStore()),e},n.prototype.deepClone=function(){return this.clone()},n.prototype._validateNested=function(t){var e=this,n=0;return this.forEachAttr(this.attributes,function(r,i,o){var s=o.validate(e,r,i);s&&(t[i]=s,n++)}),n},n.prototype.get=function(t){return this[t]},n.prototype.toJSON=function(){var t=this,e={};return this.forEachAttr(this.attributes,function(n,r,i){var o=i.toJSON;if(void 0!==n){var s=o.call(t,n,r);void 0!==s&&(e[r]=s)}}),e},n.prototype.parse=function(t,e){return this._parse(t)},n.prototype.deepSet=function(t,e,n){var r=this;return this.transaction(function(){for(var i=t.split("."),o=i.length-1,s=i[o],a=r,u=0;u<o;u++){var c=i[u],p=a.get?a.get(c):a[c];if(!p){var h=a._attributes;if(!h)return;var f=h[c].create();n&&n.nullify&&f._attributes&&f.clear(n),a[c]=p=f}a=p}a.set?a.set((l={},l[s]=e,l),n):a[s]=e;var l}),this},Object.defineProperty(n.prototype,"collection",{get:function(){return this._ownerKey?null:this._owner},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;this._disposed||(this.forEachAttr(this.attributes,function(t,n,r){r.dispose(e,t)}),t.prototype.dispose.call(this))},n.prototype._log=function(t,e,n){ie(t,"[Record] "+e,ne({Record:this,"Attributes definition:":this._attributes},n))},n.prototype.getClassName=function(){return t.prototype.getClassName.call(this)||"Record"},n.prototype._createTransaction=function(t,e){},n=r([O({cidPrefix:"m",_changeEventName:"change",idAttribute:"id"}),le(_n,In),w({defaults:de.merge,attributes:de.merge,collection:de.merge,Collection:de.value,idAttribute:de.protoValue})],n)}(Ve);Vn(Hn.prototype,qe);var Fn=function(){return function(t,e,n){this.id=e.id}}();Hn.prototype.Attributes=Fn;var qn=function(){return function(t){this.id=t.id}}();Hn.prototype.AttributesCopy=qn;var zn=Ze.create({value:void 0},"id");Hn.prototype._attributes={id:zn},Hn.prototype._attributesArray=[zn],Hn._attribute=Qe;var Wn=l,Kn=d;Hn.onExtend=function(t){Ve.onExtend.call(this,t);var n=this,i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.model=n,i=r([_],i)}(t.Collection);this.DefaultCollection=i,n.Collection===t.Collection&&(this.Collection=i),yt(this,mn)},Hn.onDefine=function(t,e){var r=e.prototype,i=bn(this.attributes=Ct(t),r._attributes),o=i.properties,s=i._localEvents,a=n(i,["properties","_localEvents"]);Wn(this.prototype,a),t.properties=Kn(t.properties||{},o),t._localEvents=s,Ve.onDefine.call(this,t,e),this.DefaultCollection.define(t.collection||{}),this.Collection=t.Collection,this.Collection.prototype.model=this,t.endpoint&&(this.Collection.prototype._endpoint=t.endpoint)},Hn._attribute=Qe,yt(Hn,mn);var Ln=M,Zn=B,Gn=I,$n=J,Qn=Me.commit,Xn=Me.aquire,Yn=Me.free,tr=function(){function t(t,e,n,r,i,o){this.object=t,this.isRoot=e,this.added=n,this.removed=r,this.nested=i,this.sorted=o}return t.prototype.commit=function(t){for(var e=this,n=e.nested,r=e.object,i=r._isDirty,o=0,s=n;o<s.length;o++)(c=s[o]).commit(r);r._aggregationError&&Tt(r);for(var a=0,u=n;a<u.length;a++){var c=u[a];Ln(r,"change",c.object,i)}for(var p=this,h=p.added,f=p.removed,l=0,d=h;l<d.length;l++){g=d[l];Zn(g,"add",g,r,i),Zn(r,"add",g,r,i)}for(var v=0,y=f;v<y.length;v++){var g=y[v];Zn(g,"remove",g,r,i),Zn(r,"remove",g,r,i)}this.sorted&&Ln(r,"sort",r,i),(h.length||f.length)&&Ln(r,"update",r,i),this.isRoot&&Qn(r,t)},t}(),er=Me.begin,nr=Me.commit,rr=Me.markAsDirty,ir=Me.begin,or=Me.commit,sr=Me.markAsDirty,ar={silent:!0},ur=M,cr=B,pr=Me.markAsDirty,hr=Me.begin,fr=Me.commit,lr=M,dr=Me.begin,vr=Me.commit,yr=Me.markAsDirty,gr=l,mr=d,br=0,_r=Array.prototype.slice,Or=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.defaultValue=[],n}(mn),wr=function(n){function i(t,e,r){void 0===e&&(e={});var i=n.call(this,br++)||this;return i.models=[],i._byId={},i.comparator=i.comparator,void 0!==e.comparator&&(i.comparator=e.comparator,e.comparator=void 0),i.model=i.model,e.model&&(i.model=e.model,e.model=void 0),i.idAttribute=i.model.prototype.idAttribute,i._shared=r||0,t&&Mt(i,Lt(i,t,e),e,!0),i.initialize.apply(i,arguments),i._localEvents&&i._localEvents.subscribe(i,i),i}return e(i,n),i,i.prototype.createSubset=function(t,e){var n=new(0,this.constructor.subsetOf(this).options.type)(t,e);return n.resolve(this),n},i.onExtend=function(e){function n(e,n,i){r.call(this,e,n,t.ItemsBehavior.share|(i?t.ItemsBehavior.listen:0))}var r=this;this._SubsetOf=null,pe.mixins.populate(n),n.prototype=this.prototype,n._attribute=Or,this.Refs=this.Subset=n,Ve.onExtend.call(this,e),yt(this,mn)},i.onDefine=function(t,e){if(t.itemEvents){var n=new ve(e.prototype._itemEvents);n.addEventsMap(t.itemEvents),this.prototype._itemEvents=n}t.comparator&&(this.prototype.comparator=t.comparator),Ve.onDefine.call(this,t)},Object.defineProperty(i.prototype,"__inner_state__",{get:function(){return this.models},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"comparator",{get:function(){return this._comparator},set:function(t){var e=this;switch(typeof t){case"string":this._comparator=function(e,n){var r=e[t],i=n[t];return r===i?0:r<i?-1:1};break;case"function":1===t.length?this._comparator=function(n,r){var i=t.call(e,n),o=t.call(e,r);return i===o?0:i<o?-1:1}:this._comparator=function(n,r){return t.call(e,n,r)};break;default:this._comparator=null}},enumerable:!0,configurable:!0}),i.prototype.getStore=function(){return this._store||(this._store=this._owner?this._owner.getStore():this._defaultStore)},i.prototype.linkContains=function(t){return new jr(this,t)},i.prototype.linkAt=function(t){var e=this;return En.value(this[t],function(n){return e[t]=n})},i.prototype._onChildrenChange=function(t,e,n){if(void 0===e&&(e={}),n!==this){var r=this.idAttribute;t.hasChanged(r)&&kt(this._byId,t);var i=dr(this);yr(this,e)&&lr(this,"change",t,e),i&&vr(this)}},i.prototype.get=function(t){if(null!=t){if("object"==typeof t){var e=t[this.idAttribute];return void 0!==e&&this._byId[e]||this._byId[t.cid]}return this._byId[t]}},i.prototype.each=function(t,e){for(var n=Zt(t,e),r=this.models,i=0;i<r.length;i++)n(r[i],i)},i.prototype.every=function(t,e){for(var n=Gt(t,e),r=this.models,i=0;i<r.length;i++)if(!n(r[i],i))return!1;return!0},i.prototype.filter=function(t,e){var n=Gt(t,e);return this.map(function(t,e){return n(t,e)?t:void 0})},i.prototype.find=function(t,e){for(var n=Gt(t,e),r=this.models,i=0;i<r.length;i++)if(n(r[i],i))return r[i];return null},i.prototype.some=function(t,e){return Boolean(this.find(t,e))},i.prototype.map=function(t,e){for(var n=Zt(t,e),r=this.models,i=Array(r.length),o=0,s=0;s<r.length;s++){var a=n(r[s],s);void 0===a||(i[o++]=a)}return i.length=o,i},i.prototype._validateNested=function(t){if(this._shared)return 0;var e=0;return this.each(function(n){var r=n.validationError;r&&(t[n.cid]=r,e++)}),e},i.prototype.initialize=function(){},Object.defineProperty(i.prototype,"length",{get:function(){return this.models.length},enumerable:!0,configurable:!0}),i.prototype.first=function(){return this.models[0]},i.prototype.last=function(){return this.models[this.models.length-1]},i.prototype.at=function(t){var e=t<0?t+this.models.length:t;return this.models[e]},i.prototype.clone=function(e){void 0===e&&(e={});var n=this._shared&t.ItemsBehavior.share?this.models:this.map(function(t){return t.clone()}),r=new this.constructor(n,{model:this.model,comparator:this.comparator},this._shared);return e.pinStore&&(r._defaultStore=this.getStore()),r},i.prototype.toJSON=function(){return this.models.map(function(t){return t.toJSON()})},i.prototype.set=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e={}),void 0!==e.add&&this._log("warn","Collection.set doesn't support 'add' option, behaving as if options.add === true.",e),e.reset)this.reset(t,e);else{var n=this._createTransaction(t,e);n&&n.commit()}return this},i.prototype.liveUpdates=function(t){var e=this;if(t){this.liveUpdates(!1);var n="function"==typeof t?t:function(){return!0};return this._liveUpdates={updated:function(t){n(t)&&e.add(t,{parse:!0,merge:!0})},removed:function(t){return e.remove(t)}},this.getEndpoint().subscribe(this._liveUpdates,this)}this._liveUpdates&&(this.getEndpoint().unsubscribe(this._liveUpdates,this),this._liveUpdates=null)},i.prototype.fetch=function(t){var e=this;void 0===t&&(t={});var n=ne({parse:!0},t);return K(this,this.getEndpoint().list(n,this),n,function(t){var r=e.set(t,ne({parse:!0},n));return n.liveUpdates&&(r=e.liveUpdates(n.liveUpdates)),r})},i.prototype.dispose=function(){if(!this._disposed){for(var t=!this._shared,e=0,r=this.models;e<r.length;e++){var i=r[e];Pt(this,i),t&&i.dispose()}this.liveUpdates(!1),n.prototype.dispose.call(this)}},i.prototype.reset=function(t,e){void 0===e&&(e={});var n=dr(this),r=At(this);return t&&Mt(this,Lt(this,t,e),e,!0),yr(this,e),e.silent||lr(this,"reset",this,mr({previousModels:r},e)),n&&vr(this),this.models},i.prototype.add=function(t,e){void 0===e&&(e={});var n=Lt(this,t,e),r=this.models.length?It(this,n,e):Mt(this,n,e);if(r)return r.commit(),r.added},i.prototype.remove=function(t,e){return void 0===e&&(e={}),t?Array.isArray(t)?zt(this,t,e):qt(this,t,e):[]},i.prototype._createTransaction=function(t,e){void 0===e&&(e={});var n=Lt(this,t,e);return this.models.length?!1===e.remove?It(this,n,e,!0):Bt(this,n,e):Mt(this,n,e)},i.prototype.pluck=function(t){return this.models.map(function(e){return e[t]})},i.prototype.sort=function(t){if(void 0===t&&(t={}),Nt(this,t)){var e=dr(this);yr(this,t)&&lr(this,"sort",this,t),e&&vr(this)}return this},i.prototype.push=function(t,e){return this.add(t,gr({at:this.length},e))},i.prototype.pop=function(t){var e=this.at(this.length-1);return this.remove(e,ne({unset:!0},t)),e},i.prototype.unset=function(t,e){var n=this.get(t);return this.remove(t,ne({unset:!0},e)),n},i.prototype.unshift=function(t,e){return this.add(t,gr({at:0},e))},i.prototype.shift=function(t){var e=this.at(0);return this.remove(e,ne({unset:!0},t)),e},i.prototype.slice=function(){return _r.apply(this.models,arguments)},i.prototype.indexOf=function(t){var e=this.get(t);return this.models.indexOf(e)},i.prototype.modelId=function(t){return t[this.model.prototype.idAttribute]},i.prototype.toggle=function(t,e){var n=Boolean(this.get(t)),r=void 0===e?!n:Boolean(e);return n!==r&&(n?this.remove(t):this.add(t)),r},i.prototype._log=function(t,e,n){ie(t,"[Collection Update] "+this.model.prototype.getClassName()+"."+this.getClassName()+": "+e,{Argument:n,"Attributes spec":this.model.prototype._attributes})},i.prototype.getClassName=function(){return n.prototype.getClassName.call(this)||"Collection"},i._attribute=Qe,i=r([O({cidPrefix:"c",model:Hn,_changeEventName:"changes",_aggregationError:null}),w({comparator:de.value,model:de.protoValue,itemEvents:de.merge})],i)}(Ve);yt(wr,mn),Hn.Collection=wr;var jr=function(t){function n(e,n){var r=t.call(this,Boolean(e._byId[n.cid]))||this;return r.collection=e,r.record=n,r}return e(n,t),n.prototype.set=function(t){this.collection.toggle(this.record,t)},n}(En),Cr=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.toJSON=function(t){return t&&"object"==typeof t?t.id:t},n.prototype.clone=function(t){return t&&"object"==typeof t?t.id:t},n.prototype.isChanged=function(t,e){return(t&&(null==t.id?t:t.id))!==(e&&(null==e.id?e:e.id))},n.prototype.validate=function(t,e,n){},n}(Ze);Hn.from=function(t){var e=$t(t);return new Ye({value:null,_attribute:Cr}).get(function(t,n){if("object"==typeof t)return t;var r=e(this),i=null;return r&&r.length&&(i=r.get(t)||null,this.attributes[n]=i,i&&this._attributes[n].handleChange(i,null,this,{})),i})},wr.subsetOf=function(t){var e=this._SubsetOf||(this._SubsetOf=Qt(this)),n=$t(t);return new Ye({type:e}).get(function(t){return!t||t.resolvedWith||t.resolve(n(this)),t})};var Ar=t.ItemsBehavior.share|t.ItemsBehavior.persistent,Er=null,Pr=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return e(n,t),n.prototype.getStore=function(){return this},n.prototype.get=function(t){var e=this[t];return e||this===this._defaultStore?e:this._owner?this._owner.get(t):this._defaultStore.get(t)},Object.defineProperty(n,"global",{get:function(){return Er},set:function(t){Er&&Er.dispose(),Ve.prototype._defaultStore=Er=t},enumerable:!0,configurable:!0}),n}(Hn);Pr.global=new Pr;var Sr,Nr=(Sr=xe).on,xr=Sr.off,Dr=Sr.trigger,kr=Sr.once,Tr=Sr.listenTo,Ir=Sr.stopListening,Rr=Sr.listenToOnce;t.on=Nr,t.off=xr,t.trigger=Dr,t.once=kr,t.listenTo=Tr,t.stopListening=Ir,t.listenToOnce=Rr,t.Model=Hn,t.Class=pe,t.attributes=function(t){return function(n){function i(){return null!==n&&n.apply(this,arguments)||this}return e(i,n),i.attributes=t,i=r([O],i)}(Hn)},t.value=function(t){return new Ye({value:t})},t.transaction=function(t){return function(){for(var e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i;return this.transaction(function(){i=t.apply(e,n)}),i}},t.createIOPromise=function(t){function e(t){i=t}var n,r,i,o=new Promise(function(i,o){t(n=i,r=o,e)});return o.abort=function(){i?i(n,r):r(new Error("I/O Aborted"))},o},t.tools=ce,t.eventsApi=_e,t.Mixable=pe,t.predefine=_,t.define=O,t.definitions=w,t.definitionDecorator=j,t.MixinsState=he,t.mixins=le,t.mixinRules=de,t.EventMap=ve,t.Messenger=Ne,t.Events=xe,t.Collection=wr,t.CollectionLink=jr,t.Store=Pr,t.Record=Hn,t.attr=function(t,e){if(!e)return t.asProp;"undefined"!=typeof Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",t,e).asProp(t,e):t._log("error",'Add import "reflect-metadata"; as the first line of your app.')},t.prop=function(t){return t.asProp},t.createAttribute=lt,t.createSharedTypeSpec=yt,t.AnyType=Ze,t.AggregatedType=Qe,t.DateType=tn,t.MSDateType=nn,t.TimestampType=rn,t.PrimitiveType=un,t.NumericType=cn,t.ArrayType=pn,t.ObjectType=hn,t.doNothing=ht,t.FunctionType=fn,t.SharedType=mn,t.setAttribute=$,t.UpdateRecordMixin=qe,t.constructorsMixin=Y,t.shouldBeAnObject=tt,t.RecordTransaction=ze,t.ChainableAttributeSpec=Ye,t.toAttributeOptions=st,t.Transactional=Ve,t.transactionApi=Me,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
