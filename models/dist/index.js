!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Nested={})}(this,function(s){"use strict";function a(t,e){for(var n in e)e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n]);if(2<arguments.length)for(var r=2;r<arguments.length;r++){var o=arguments[r];o&&a(t,o)}return t}function g(t){if(null===t)return!0;switch(typeof t){case"number":case"string":case"boolean":return!0;case"object":var e=Object.getPrototypeOf(t);if(e===Object.prototype||e===Array.prototype)return r(t,g)}return!1}function i(t){return Object.getPrototypeOf(t.prototype).constructor}function e(t){if(t)for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function n(t,e){return(Object.getPrototypeOf(t)===o?function(t,e){for(var n,r=0;r<t.length;r++)if(n=e(t[r],r))return n}:function(t,e){var n;for(var r in t)if(t.hasOwnProperty(r)&&(n=e(t[r],r)))return n})(t,e)}function r(t,e){return!n(t,function(t){return!e(t)})}function t(t){for(var e={},n={},r=1;r<arguments.length;r++)n[arguments[r]]=!0;for(var o in t)!n.hasOwnProperty(o)&&t.hasOwnProperty(o)&&(e[o]=t[o]);return e}function u(t,e,n){for(var r in e){var o;e.hasOwnProperty(r)&&(void 0===(o=n(e[r],r))||(t[r]=o))}return t}function c(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);if(2<arguments.length)for(var r=2;r<arguments.length;r++){var o=arguments[r];o&&c(t,o)}return t}function l(t){var e,n=!0;return function(){return n&&(n=!1,e=t.apply(this,arguments),t=null),e}}var o=Array.prototype,p=Date.prototype,h=Object.prototype;function f(t,e){if(t===e)return!1;if(t&&e&&"object"==typeof t&&"object"==typeof e){var n=Object.getPrototypeOf(t);if(n!==Object.getPrototypeOf(e))return!0;switch(n){case p:return+t!=+e;case o:return function(t,e){if(t.length!==e.length)return!0;for(var n=0;n<t.length;n++)if(f(t[n],e[n]))return!0;return!1}(t,e);case h:case null:return function(t,e){var n=Object.keys(t);if(n.length!==Object.keys(e).length)return!0;for(var r=0;r<n.length;r++){var o=n[r];if(!e.hasOwnProperty(o)||f(t[o],e[o]))return!0}return!1}(t,e)}}return!0}var d=Object.create(null);function v(t){var e=Object.create(d);return t?c(e,t):e}function y(t,e){if(t==e)return 0;if(null==t)return-1;if(null==e)return 1;var n=t.valueOf(),r=e.valueOf();return n<r?-1:r<n?1:0}d.hasOwnProperty=h.hasOwnProperty;var m=Object.freeze({__proto__:null,defaults:a,isValidJSON:g,getBaseClass:i,assignToClassProto:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];for(var o=0,i=n;o<i.length;o++){var s=i[o],a=e[s];void 0===a||(t.prototype[s]=a)}},isEmpty:e,some:n,every:r,getPropertyDescriptor:function(t,e){for(var n,r=t;!n&&r;r=Object.getPrototypeOf(r))n=Object.getOwnPropertyDescriptor(r,e);return n},omit:t,transform:u,fastAssign:function(t,e){for(var n in e)t[n]=e[n];return t},fastDefaults:function(t,e){for(var n in e)void 0===t[n]&&(t[n]=e[n]);return t},assign:c,keys:function(t){return t?Object.keys(t):[]},once:l,notEqual:f,hashMap:v,compare:y}),b=(_.prototype.merge=function(t){this.handlers=this.handlers.concat(t.handlers)},_.prototype.addEventsMap=function(t){for(var e in t)this.addEvent(e,t[e])},_.prototype.bubbleEvents=function(t){for(var e=0,n=t.split(k);e<n.length;e++){var r=n[e];this.addEvent(r,j(r))}},_.prototype.addEvent=function(t,e){for(var n=this.handlers,r=0,o=t.split(k);r<o.length;r++){var i=o[r];n.push(new O(i,e))}},_.prototype.subscribe=function(t,e){for(var n=0,r=this.handlers;n<r.length;n++){var o=r[n];P(e,o.name,o.callback,t)}},_.prototype.unsubscribe=function(t,e){for(var n=0,r=this.handlers;n<r.length;n++){var o=r[n];T(e,o.name,o.callback,t)}},_);function _(t){this.handlers=[],t&&(t instanceof _?this.handlers=t.handlers.slice():t&&this.addEventsMap(t))}var O=function(t,e){this.name=t,this.callback=!0===e?j(t):"string"==typeof e?function(){var t=this[e];t&&t.apply(this,arguments)}:e},w={};function j(i){return w[i]||(w[i]=function(t,e,n,r,o){void 0===r&&void 0===o||I(this,i,t,e,n,r,o),void 0!==n?D(this,i,t,e,n):x(this,i,t,e)})}var C=function(t,e,n){void 0===n&&(n=null),this.callback=t,this.context=e,this.next=n};function A(t,e,n,r){for(var o,i,s=t[e],a=s;a;a=a.next)n&&n!==a.callback&&n!==a.callback._callback||r&&r!==a.context?(i=a,o=o||a):i&&(i.next=a.next);s!==o&&(t[e]=o)}function E(t,e,n,r){for(var o=t;o;o=o.next)o.callback.call(o.context,e,n,r)}function P(t,e,n,r){var o;n&&((o=t._events||(t._events=Object.create(null)))[e]=new C(n,r,o[e]))}function S(t,e,n,r){var o;n&&((o=l(function(){T(t,e,o),n.apply(this,arguments)}))._callback=n,P(t,e,o,r))}function T(t,e,n,r){var o=t._events;if(o)if(n||r)if(e)A(o,e,n,r);else for(var i in o)A(o,i,n,r);else e?o[e]=void 0:t._events=void 0}var k=/\s+/;function N(t,e,n,r,o){if(k.test(n))for(var i=0,s=n.split(k);i<s.length;i++){t(e,s[i],r,o)}else t(e,n,r,o)}function x(t,e,n,r){var o,i,s=t._events;s&&(o=s[e],i=s.all,function(t,e,n){for(var r=t;r;r=r.next)r.callback.call(r.context,e,n)}(o,n,r),E(i,e,n,r))}function D(t,e,n,r,o){var i,s,a=t._events;a&&(i=a[e],s=a.all,E(i,n,r,o),function(t,e,n,r,o){for(var i=t;i;i=i.next)i.callback.call(i.context,e,n,r,o)}(s,e,n,r,o))}function I(t,e,n,r,o,i,s){var a,u,c=t._events;c&&(a=c[e],u=c.all,function(t,e,n,r,o,i){for(var s=t;s;s=s.next)s.callback.call(s.context,e,n,r,o,i)}(a,n,r,o,i,s),function(t,e,n,r,o,i,s){for(var a=t;a;a=a.next)a.callback.call(a.context,e,n,r,o,i,s)}(u,e,n,r,o,i,s))}var R=Object.freeze({__proto__:null,EventMap:b,EventDescriptor:O,EventHandler:C,on:P,once:S,off:T,strings:N,trigger2:x,trigger3:D,trigger5:I}),M=function(t,e){return(M=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function J(t,e){function n(){this.constructor=t}M(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var V=function(){return(V=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function U(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n}function B(t,e,n,r){var o,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;0<=a;a--)(o=t[a])&&(s=(i<3?o(s):3<i?o(e,n,s):o(e,n))||s);return 3<i&&s&&Object.defineProperty(e,n,s),s}var L=(H.define=function(t,e){void 0===t&&(t={});var n=i(this);e&&c(this,e);var r=t.mixins,o=U(t,["mixins"]);return r&&this.mixins.merge(r),this.mixins.mergeObject(this.prototype,o,!0),this.mixins.mergeObject(this.prototype,this.mixins.getStaticDefinitions(n),!0),this.onDefine&&this.onDefine(this.mixins.definitions,n),this.mixins.mergeInheritedMembers(n),this},H.extend=function(t,e){var n,r;function o(){return null!==r&&r.apply(this,arguments)||this}return t&&t.hasOwnProperty("constructor")?J(n=t.constructor,this):(J(o,r=this),n=o),$(n),t&&n.define(t,e),n},H);function H(){}function $(t){var e=i(t);t.__super__=e.prototype,t.define||q.get(L).populate(t),q.get(t),t.onExtend&&t.onExtend(e)}function F(e){if("function"!=typeof e)return function(t){$(t),t.define(e)};$(e),e.define()}function W(n){return function(t){var e=q.get(t);e.definitionRules=a(v(),n,e.definitionRules)}}function z(o,i){return function(t,e){var n,r;q.get(t.constructor).mergeObject(t,((n={})[o]=((r={})[e]=i,r),n))}}var q=(K.get=function(t){var e=t.mixins;return e&&t===e.Class?e:t.mixins=new K(t)},K.prototype.getStaticDefinitions=function(n){var t=v(),r=this.Class;return u(t,this.definitionRules,function(t,e){if(n[e]!==r[e])return r[e]})},K.prototype.merge=function(t){for(var e=this.Class.prototype,n=(this.mergeRules,this.appliedMixins=this.appliedMixins.slice()),r=0,o=t;r<o.length;r++){var i,s=o[r];Array.isArray(s)?this.merge(s):n.indexOf(s)<0&&(n.push(s),"function"==typeof s?(this.mergeObject(this.Class,s),(i=s.mixins)&&(this.mergeRules=a(v(),this.mergeRules,i.mergeRules),this.definitionRules=a(v(),this.definitionRules,i.definitionRules),this.appliedMixins=this.appliedMixins.concat(i.appliedMixins)),this.mergeObject(e,s.prototype)):this.mergeObject(e,s))}},K.prototype.populate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,r=t;n<r.length;n++){var o=r[n];K.get(o).merge([this.Class])}},K.prototype.mergeObject=function(r,o,i){var s=this;!function(t,e){for(var n=Z[typeof t],r=0,o=Object.getOwnPropertyNames(t);r<o.length;r++){var i=o[r];n[i]||e(i)}}(o,function(t){var e,n=Object.getOwnPropertyDescriptor(o,t);(e=s.definitionRules[t])&&X(s.definitions,t,n,e,i),e&&e!==Q.protoValue||X(r,t,n,s.mergeRules[t],i)})},K.prototype.mergeInheritedMembers=function(t){var e=this.mergeRules,n=this.Class;if(e){var r=n.prototype,o=t.prototype;for(var i in e){var s=e[i];r.hasOwnProperty(i)&&i in o&&(r[i]=Y(r[i],o[i],s))}}},K);function K(t){this.Class=t,this.definitions={};var e=i(t).mixins;this.mergeRules=e&&e.mergeRules||v(),this.definitionRules=e&&e.definitionRules||v(),this.appliedMixins=e&&e.appliedMixins||[]}var Z={function:v({length:!0,prototype:!0,caller:!0,arguments:!0,name:!0,__super__:!0}),object:v({constructor:!0})};function G(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return q.get(t).merge(e)}}var Q=function(n){return function(t){var e=q.get(t);e.mergeRules=a(n,e.mergeRules)}};function X(t,e,n,r,o){var i;t.hasOwnProperty(e)?(i=Object.getOwnPropertyDescriptor(t,e)).configurable&&"value"in i&&(t[e]=o?Y(n.value,i.value,r):Y(i.value,n.value,r)):Object.defineProperty(t,e,n)}function Y(t,e,n){return void 0===t?e:n&&void 0!==e?n(t,e):t}Q.value=function(t,e){return t},Q.protoValue=function(t,e){return t},Q.merge=function(t,e){return a({},t,e)},Q.pipe=function(e,n){return function(t){return e.call(this,n.call(this,t))}},Q.defaults=function(t,e){return function(){return a(t.apply(this,arguments),e.apply(this,arguments))}},Q.classFirst=function(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}},Q.classLast=function(t,e){return function(){e.apply(this,arguments),t.apply(this,arguments)}},Q.every=function(t,e){return function(){return t.apply(this,arguments)&&e.apply(this,arguments)}},Q.some=function(t,e){return function(){return t.apply(this,arguments)||e.apply(this,arguments)}};var tt=N,et=P,nt=T,rt=S,ot=I,it=x,st=D,at=0;function ut(){return"l"+at++}var ct=(lt.onDefine=function(t,e){var n,r=t.localEvents,o=t._localEvents,i=t.properties;(r||o)&&(n=new b(this.prototype._localEvents),r&&n.addEventsMap(r),o&&n.merge(o),this.prototype._localEvents=n),i&&Object.defineProperties(this.prototype,u({},i,ht))},lt.prototype.initialize=function(){},lt.prototype.on=function(t,e,n){if("string"==typeof t)tt(et,this,t,e,n);else for(var r in t)tt(et,this,r,t[r],n||e);return this},lt.prototype.once=function(t,e,n){if("string"==typeof t)tt(rt,this,t,e,n);else for(var r in t)tt(rt,this,r,t[r],n||e);return this},lt.prototype.off=function(t,e,n){if(t)if("string"==typeof t)tt(nt,this,t,e,n);else for(var r in t)tt(nt,this,r,t[r],n||e);else nt(this,void 0,e,n);return this},lt.prototype.trigger=function(t,e,n,r,o,i){return void 0!==o||void 0!==i?ot(this,t,e,n,r,o,i):void 0!==r?st(this,t,e,n,r):it(this,t,e,n),this},lt.prototype.listenTo=function(t,e,n){return t&&(ft(this,t),t.on(e,n||"object"!=typeof e?n:this,this)),this},lt.prototype.listenToOnce=function(t,e,n){return t&&(ft(this,t),t.once(e,n||"object"!=typeof e?n:this,this)),this},lt.prototype.stopListening=function(t,e,n){var r=this._listeningTo;if(r){var o=!(e||n),i=n||"object"!=typeof e?n:this;if(t){var s=r[t.cid];s&&(o&&delete r[t.cid],s.off(e,i,this))}else if(null==t){for(var a in r)r[a].off(e,i,this);o&&(this._listeningTo=void 0)}}return this},lt.prototype.dispose=function(){this._disposed||(this.stopListening(),this.off(),this._disposed=!0)},B([F,W({properties:Q.merge,localEvents:Q.merge})],lt));function lt(){this._events=void 0,this._listeningTo=void 0,this.cid=ut(),this.initialize.apply(this,arguments)}var pt=t(ct.prototype,"constructor","initialize");function ht(t){if(t)return"function"==typeof t?{get:t,configurable:!0}:t}function ft(t,e){(t._listeningTo||(t._listeningTo=Object.create(null)))[e.cid||(e.cid=ut())]=e}var dt,vt="undefined"!=typeof process&&process.env&&"production"===process.env.NODE_ENV,yt=vt?["error","info"]:["error","warn","debug","info","log"],gt=(J(mt,dt=ct),mt.prototype.logToConsole=function(i,s){return this.on(i,function(t,e,n){if(!s||s.test(t)){var r=["["+t+"] "+e];for(var o in n)r.push("\n\t"+o+":",bt(n[o]));console[i].apply(console,r)}})},mt.prototype.throwOn=function(t,r){return this.on(t,function(t,e,n){if(!r||r.test(t))throw new Error("["+t+"] "+e)})},mt.prototype.count=function(r,o){var i=this;return this.on(r,function(t,e,n){o&&!o.test(t)||(i.counter[r]=(i.counter[r]||0)+1)})},mt.prototype.on=function(t,e){return dt.prototype.on.call(this,t,e)},B([F],mt));function mt(){var t=null!==dt&&dt.apply(this,arguments)||this;return t.counter={},t}var bt="undefined"==typeof window?function(t){if(t&&"object"==typeof t){var e=t.__inner_state__||t,n=Array.isArray(e)?"[ length = "+e.length+" ]":"{ "+Object.keys(e).join(", ")+" }";return t.constructor.name+" "+n}return JSON.stringify(t)}:function(t){return t},_t=new gt;if("undefined"!=typeof console)for(var Ot=0,wt=yt;Ot<wt.length;Ot++){var jt=wt[Ot];_t.logToConsole(jt)}var Ct=new gt;Ct.throwOn("error").throwOn("warn");var At=_t.trigger.bind(_t);function Et(n,t,r,o){return Pt(n),n._ioPromise=t.then(function(t){n._ioPromise=null;var e=o?o(t):t;return St(n,"sync",n,t,r),e}).catch(function(t){throw n._ioPromise=null,St(n,"error",n,t,r),t}),n._ioPromise.abort=t.abort,n._ioPromise}function Pt(t){t._ioPromise&&t._ioPromise.abort&&(t._ioPromise.abort(),t._ioPromise=null)}function St(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t.trigger.apply(t,e);var r=t.collection;r&&r.trigger.apply(r,e)}var Tt=/\^|(store\.[^.]+)|([^.]+)/g,kt=function(t,e){void 0===e&&(e=!1);var n=t.match(Tt).map(function(t){return"^"===t||"owner"===t?"getOwner()":"~"===t[0]?'getStore().get("'+t.substr(1)+'")':0===t.indexOf("store.")?'getStore().get("'+t.substr(6)+'")':t});this.tail=e&&n.pop(),this.local=!n.length,this.resolve=new Function("self","\n            var v = self."+n.shift()+";\n                           \n            "+n.map(function(t){return"\n                v = v && v."+t+";\n            "}).join("")+"\n\n            return v;\n        ")};function Nt(t,e,n){for(var r=e.match(Tt),o=r.length-1,i=t,s=0;s<o;s++){var a=r[s];switch(a){case"~":i=i.getStore();break;case"^":i=i.getOwner();break;default:i=i.get(a)}if(!i)return}return n(i,r[o])}var xt=(Dt.prototype.each=function(t){var e=this.error,n=this.nested;for(var r in e&&t(e,null),n)t(n[r],r)},Dt.prototype.eachError=function(n,r){this.each(function(t,e){t instanceof Dt?t.eachError(n,r.get(e)):n(t,e,r)})},Dt);function Dt(t){this.length=t._validateNested(this.nested={}),(this.error=t.validate(t))&&this.length++}var It=Array.prototype,Rt=Object.prototype;function Mt(t){if(t&&"object"==typeof t)switch(Object.getPrototypeOf(t)){case It:return Bt;case Rt:return Ut}return Vt}var Jt,Vt={clone:function(t){return t},map:function(t,e){return[]},remove:function(t){return t}},Ut={map:function(t,e){var n,r=[],o=t.value;for(var i in o){o.hasOwnProperty(i)&&(void 0===(n=e(t.at(i),i))||r.push(n))}return r},remove:function(t,e){return delete t[e],t},clone:function(t){return V({},t)}},Bt={clone:function(t){return t.slice()},remove:function(t,e){return t.splice(e,1),t},map:function(t,e){for(var n=t.value.length,r=Array(n),o=0,i=0;o<n;o++){var s=e(t.at(o),o);void 0===s||(r[i++]=s)}return r.length===i||(r.length=i),r}};function Lt(t){this.value=t,this.error=void 0}s.Linked=(Object.defineProperty(Lt.prototype,"current",{get:function(){return this.value},set:function(t){this.set(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Lt.prototype,"_changeToken",{get:function(){return this.value},enumerable:!0,configurable:!0}),Lt.prototype.onChange=function(e){var n=this;return new zt(this,function(t){e(t),n.set(t)})},Lt.prototype.pipe=function(n){var r=this;return new zt(this,function(t){var e=n(t,r.value);void 0===e||r.set(e)})},Object.defineProperty(Lt.prototype,"props",{get:function(){var e=this;return"boolean"==typeof this.value?{checked:this.value,onChange:function(t){return e.set(Boolean(t.target.checked))}}:{value:this.value,onChange:function(t){return e.set(t.target.value)}}},enumerable:!0,configurable:!0}),Lt.prototype.update=function(t,e){var n=t(this.clone(),e);void 0===n||this.set(n)},Lt.prototype.action=function(e){var n=this;return function(t){return n.update(e,t)}},Lt.prototype.equals=function(t){return new Zt(this,t)},Object.defineProperty(Lt.prototype,"true",{get:function(){var t=this;return function(){return t.set(!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(Lt.prototype,"false",{get:function(){var t=this;return function(){return t.set(!1)}},enumerable:!0,configurable:!0}),Object.defineProperty(Lt.prototype,"null",{get:function(){var t=this;return function(){return t.set(null)}},enumerable:!0,configurable:!0}),Object.defineProperty(Lt.prototype,"isTruthy",{get:function(){return!!this.value||void 0},enumerable:!0,configurable:!0}),Lt.prototype.enabled=function(t){return new Xt(this,t||"")},Lt.prototype.contains=function(t){return new ee(this,t)},Lt.prototype.push=function(){var t=Bt.clone(this.value);Array.prototype.push.apply(t,arguments),this.set(t)},Lt.prototype.unshift=function(){var t=Bt.clone(this.value);Array.prototype.unshift.apply(t,arguments),this.set(t)},Lt.prototype.splice=function(){var t=Bt.clone(this.value);Array.prototype.splice.apply(t,arguments),this.set(t)},Lt.prototype.map=function(t){return Mt(this.value).map(this,t)},Lt.prototype.removeAt=function(t){var e=this.value,n=Mt(e);this.set(n.remove(n.clone(e),t))},Lt.prototype.at=function(t){return new ie(this,t)},Lt.prototype.clone=function(){var t=this.value;return Mt(t).clone(t)},Lt.prototype.pick=function(){for(var t={},e=arguments.length?arguments:Object.keys(this.value),n=0;n<e.length;n++){var r=e[n];t[r]=new ie(this,r)}return t},Object.defineProperty(Lt.prototype,"$",{get:function(){if(!this._value$){var t=this._value$={},e=this.value;for(var n in e)e.hasOwnProperty(n)&&(t[n]=new ie(this,n))}return this._value$},enumerable:!0,configurable:!0}),Lt.prototype.check=function(t,e){return this.error||t(this.value)||(this.error=e||t.error||oe),this},Lt),(Jt=s.Linked||(s.Linked={})).value=function(t,e){return new $t(t,e)},Jt.mutable=function(n){return new $t(n,function(t){for(var e in t)t.hasOwnProperty(e)&&(n[e]=t[e])})},Jt.getValues=function(t){return ae(t,"value")},Jt.getErrors=function(t){return ae(t,"error")},Jt.hasErrors=function(t){for(var e in t)if(t.hasOwnProperty(e)&&t[e].error)return!0;return!1},Jt.setValues=function(t,e){if(e)for(var n in t){var r,o=ue(n);e.hasOwnProperty(o)&&(void 0===(r=e[o])||t[n].set(r))}};var Ht,$t=(J(Ft,Ht=s.Linked),Ft.prototype.set=function(t){},Ft);function Ft(t,e){var n=Ht.call(this,t)||this;return n.set=e,n}var Wt,zt=(J(qt,Wt=s.Linked),qt.prototype.set=function(t){},qt);function qt(t,e){var n=Wt.call(this,t.value)||this;n.set=e;var r=t.error;return r&&(n.error=r),n}var Kt,Zt=(J(Gt,Kt=s.Linked),Gt.prototype.set=function(t){this.parent.set(t?this.truthyValue:null)},Gt);function Gt(t,e){var n=Kt.call(this,t.value===e)||this;return n.parent=t,n.truthyValue=e,n}var Qt,Xt=(J(Yt,Qt=s.Linked),Yt.prototype.set=function(t){this.parent.set(t?this.defaultValue:null)},Yt);function Yt(t,e){var n=Qt.call(this,null!=t.value)||this;return n.parent=t,n.defaultValue=e,n}var te,ee=(J(ne,te=s.Linked),ne.prototype.set=function(t){var e,n,r=this,o=Boolean(t);this.value!==o&&(e=this.parent.value,n=t?e.concat(this.element):e.filter(function(t){return t!==r.element}),this.parent.set(n))},ne);function ne(t,e){var n=te.call(this,0<=t.value.indexOf(e))||this;return n.parent=t,n.element=e,n}var re,oe="Invalid value",ie=(J(se,re=s.Linked),se.prototype.remove=function(){this.parent.removeAt(this.key)},se.prototype.update=function(r,o){var i=this.key;this.parent.update(function(t){var e=t[i],n=r(Mt(e).clone(e),o);if(void 0!==n)return t[i]=n,t})},se.prototype.set=function(e){var n=this.key;this.parent.update(function(t){if(t[n]!==e)return t[n]=e,t})},se);function se(t,e){var n=re.call(this,t.value[e])||this;return n.parent=t,n.key=e,n}function ae(t,e){var n,r={};for(var o in t){!t.hasOwnProperty(o)||void 0!==(n=t[o][e])&&(r[ue(o)]=n)}return r}function ue(t){return"$"===t[0]?t.slice(1):t}var ce,le=D,pe=P,he=T;(ce=s.ItemsBehavior||(s.ItemsBehavior={}))[ce.share=1]="share",ce[ce.listen=2]="listen",ce[ce.persistent=4]="persistent";var fe,de=((fe=ve).onDefine=function(t,e){t.endpoint&&(this.prototype._endpoint=t.endpoint),ct.onDefine.call(this,t,e)},ve.onExtend=function(t){t.create===this.create&&(this.create=fe.create)},ve.create=function(t,e){return new this(t,e)},ve.prototype.dispose=function(){this._disposed||(Pt(this),this._owner=void 0,this._ownerKey=void 0,this.off(),this.stopListening(),this._disposed=!0)},ve.prototype.onChanges=function(t,e){pe(this,this._changeEventName,t,e)},ve.prototype.offChanges=function(t,e){he(this,this._changeEventName,t,e)},ve.prototype.listenToChanges=function(t,e){this.listenTo(t,t._changeEventName,e)},ve.prototype.transaction=function(t,e){var n=ye.begin(this),r=t.call(this,this);r&&this.set(r),n&&ye.commit(this)},ve.prototype.assignFrom=function(t){var e=this,n=t instanceof s.Linked?t.value:t;return this.transaction(function(){e.set(n.__inner_state__||n,{merge:!0});var t=n._changeToken;t&&(e._changeToken=t)}),this},ve.from=function(t,e){void 0===e&&(e={});var n=e.strict,r=U(e,["strict"]),o=this.create(t,V(V({},r),{logger:n?Ct:void 0}));return n&&o.validationError&&o.eachValidationError(function(t,e,n){throw new Error(n.getClassName()+"."+e+": "+t)}),o},ve.prototype.parse=function(t,e){return t},ve.prototype.deepGet=function(t){return Nt(this,t,function(t,e){return t.get?t.get(e):t[e]})},ve.prototype.getOwner=function(){return this._owner},ve.prototype.getStore=function(){var t=this._owner;return t?t.getStore():this._defaultStore},ve.prototype.hasPendingIO=function(){return this._ioPromise},ve.prototype.getEndpoint=function(){return function t(e){var n=e.collection;if(n)return t(n);if(e._owner){var r=e._owner._endpoints;return r&&r[e._ownerKey]}}(this)||this._endpoint},Object.defineProperty(ve.prototype,"validationError",{get:function(){var t=this._validationError||(this._validationError=new xt(this));return t.length?t:null},enumerable:!0,configurable:!0}),ve.prototype.validate=function(t){},ve.prototype.getValidationError=function(t){var e=this.validationError;return(t?e&&e.nested[t]:e)||null},ve.prototype.deepValidationError=function(t){return Nt(this,t,function(t,e){return t.getValidationError(e)})},ve.prototype.eachValidationError=function(t){var e=this.validationError;e&&e.eachError(t,this)},ve.prototype.isValid=function(t){return!this.getValidationError(t)},ve.prototype.valueOf=function(){return this.cid},ve.prototype.toString=function(){return this.cid},ve.prototype.getClassName=function(){var t=this.constructor.name;if("Subclass"!==t)return t},fe=B([F,W({endpoint:Q.value}),G(ct)],ve));function ve(t){this._changeToken={},this._transaction=!1,this._isDirty=null,this._owner=void 0,this._ownerKey=void 0,this._validationError=void 0,this.cid=this.cidPrefix+t}var ye={begin:function(t){return!t._transaction&&(t._transaction=!0)},markAsDirty:function(t,e){var n=!e.silent;return n&&(t._isDirty=e),t._changeToken={},t._validationError=void 0,n},commit:function(t,e){var n=t._isDirty;if(n){for(;t._isDirty;){var r=t._isDirty;t._isDirty=null,le(t,t._changeEventName,t,r,e)}t._transaction=!1;var o=t._owner;o&&o!==e&&o._onChildrenChange(t,n)}else t._isDirty=null,t._transaction=!1},aquire:function(t,e,n){if(e._owner)throw new ReferenceError("Trying to aquire ownership for an object already having an owner");e._owner=t,e._ownerKey=n},free:function(t,e){t===e._owner&&(e._owner=void 0,e._ownerKey=void 0)}};var ge=ye.begin,me=ye.markAsDirty,be=ye.commit,_e=D;function Oe(t,e,n){var r=we(t),o={};t._attributes[e].doUpdate(n,t,o)&&(je(t,o),_e(t,"change:"+e,t,t.attributes[e],o)),r&&be(t)}function we(t){return!!ge(t)&&(t._previousAttributes=new t.AttributesCopy(t.attributes),!(t._changedAttributes=null))}function je(t,e){return t._changedAttributes&&(t._changedAttributes=null),me(t,e)}var Ce={transaction:function(t,e){var n=we(this);t.call(this,this),n&&be(this)},_onChildrenChange:function(t,e){var n=t._ownerKey,r=this._attributes[n];r&&!r.propagateChanges||this.forceAttributeChange(n,e)},forceAttributeChange:function(t,e){void 0===e&&(e={});var n=we(this);je(this,e)&&_e(this,"change:"+t,this,this.attributes[t],e),n&&be(this)},_createTransaction:function(t,e){void 0===e&&(e={});var n,r=we(this),o=[],i=[],s=this._attributes,a=e.parse?this.parse(t,e):t;if(Ee(this,a,e)){for(var u in a){var c=s[u];c?c.doUpdate(a[u],this,e,i)&&o.push(u):(n=n||[]).push("'"+u+"'")}n&&Ae(this,n,{values:a},e)}if(o.length&&je(this,e))return new Pe(this,r,i,o);for(var l=0,p=i;l<p.length;l++){p[l].commit(this)}r&&be(this)}};function Ae(t,e,n,r){t._log("warn","Type-R:UnknownAttrs","undefined attributes "+e.join(", ")+" are ignored.",n,r.logger)}function Ee(t,e,n){if(e&&e.constructor===Object)return 1;t._log("error","Type-R:InvalidObject","update with non-object is ignored!",{values:e},n.logger)}var Pe=(Se.prototype.commit=function(t){for(var e=this.nested,n=this.object,r=this.changes,o=0,i=e;o<i.length;o++){i[o].commit(n)}for(var s=n.attributes,a=n._isDirty,u=0,c=r;u<c.length;u++){var l=c[u];_e(n,"change:"+l,n,s[l],a)}this.isRoot&&be(n,t)},Se);function Se(t,e,n,r){this.object=t,this.isRoot=e,this.nested=n,this.changes=r}var Te=f,ke={},Ne=(xe.prototype.canBeUpdated=function(t,e,n){},xe.prototype.transform=function(t,e,n,r){return t},xe.prototype.convert=function(t,e,n,r){return t},xe.prototype.isChanged=function(t,e){return Te(t,e)},xe.prototype.handleChange=function(t,e,n,r){},xe.prototype.create=function(){},xe.prototype.clone=function(t,e){return t},xe.prototype.dispose=function(t,e){this.handleChange(void 0,e,t,ke)},xe.prototype.validate=function(t,e,n){},xe.prototype.toJSON=function(t,e,n){return t&&t.toJSON?t.toJSON(n):t},xe.prototype.isMutableType=function(){return this.type&&this.type.prototype instanceof de},xe.prototype.createPropertyDescriptor=function(){var e=this.name,t=this.getHook;if("id"!==e)return{set:function(t){Oe(this,e,t)},get:t?function(){return t.call(this,this.attributes[e],e)}:function(){return this.attributes[e]},configurable:!0}},xe.prototype.initialize=function(t,e){},xe.prototype.doInit=function(t,e,n){var r=void 0===t?this.defaultValue():t,o=this.transform(r,void 0,e,n);return this.handleChange(o,void 0,e,n),o},xe.prototype.doUpdate=function(t,e,n,r){var o=this.name,i=e.attributes,s=i[o],a=this.transform(t,s,e,n);return i[o]=a,!!this.isChanged(a,s)&&(this.handleChange(a,s,e,n),!0)},xe.prototype._log=function(t,e,n,r,o,i){o._log(t,e,o.getClassName()+"."+this.name+" "+n,{"New value":r,"Prev. value":o.attributes[this.name]},i)},xe.prototype.defaultValue=function(){return this.value},xe);function xe(t,e){this.name=t,this.getHook=null,this.options=e;var n=V({getHooks:[],transforms:[],changeHandlers:[]},e);n.getHooks=n.getHooks.slice(),n.transforms=n.transforms.slice(),n.changeHandlers=n.changeHandlers.slice();var r,o,i,s=n.value,a=n.type,u=n.parse,c=n.toJSON,l=n.changeEvents,p=n.validate,h=n.getHooks,f=n.transforms,d=n.changeHandlers;this.value=s,this.type=a,!n.hasCustomDefault&&a?this.defaultValue=this.create:g(s)?this.defaultValue=new Function("return "+JSON.stringify(s)+";"):this.defaultValue=this.defaultValue,this.propagateChanges=!1!==l,this.toJSON=void 0===c?this.toJSON:c,this.validate=p||this.validate,n.isRequired&&(this.validate=(r=this.validate,function(t,e,n){return e?r.call(this,t,e,n):"Required"})),f.unshift(this.convert),this.get&&h.unshift(this.get),this.initialize.call(this,n),h.length&&(o=this.getHook=h.reduce(De),i=this.validate,this.validate=function(t,e,n){return i.call(this,t,o.call(t,e,n),n)}),this.transform=f.length?f.reduce(Ie):this.transform,this.handleChange=d.length?d.reduce(Re):this.handleChange;var v=this.doInit,y=this.doUpdate;this.doInit=u?function(t,e,n){return v.call(this,n.parse&&void 0!==t?u.call(e,t,this.name):t,e,n)}:v,this.doUpdate=u?function(t,e,n,r){return y.call(this,n.parse&&void 0!==t?u.call(e,t,this.name):t,e,n,r)}:y}function De(n,r){return function(t,e){return r.call(this,n.call(this,t,e),e)}}function Ie(o,i){return function(t,e,n,r){return i.call(this,o.call(this,t,e,n,r),e,n,r)}}function Re(o,i){return function(t,e,n,r){o.call(this,t,e,n,r),i.call(this,t,e,n,r)}}var Me,Je=(J(Ve,Me=Ne),Ve.prototype.create=function(){return new this.type},Ve.prototype.convert=function(t){return null==t||t instanceof this.type?t:new this.type(t)},Ve.prototype.toJSON=function(t,e,n){return t&&t.toJSON?t.toJSON(n):t},Ve.prototype.clone=function(t){return new this.type(this.toJSON(t))},Ve.prototype.isChanged=function(t,e){return t!==e},Ve);function Ve(){return null!==Me&&Me.apply(this,arguments)||this}var Ue,Be=(J(Le,Ue=Ne),Le.prototype.dispose=function(){},Le.prototype.create=function(){return this.type()},Le.prototype.toJSON=function(t){return t},Le.prototype.convert=function(t){return null==t?t:this.type(t)},Le.prototype.isChanged=function(t,e){return t!==e},Le.prototype.clone=function(t){return t},Le.prototype.doInit=function(t,e,n){return this.transform(void 0===t?this.value:t,void 0,e,n)},Le.prototype.doUpdate=function(t,e,n,r){var o=this.name,i=e.attributes,s=i[o];return s!==(i[o]=this.transform(t,s,e,n))},Le.prototype.initialize=function(){this.options.hasCustomDefault||(this.value=this.type())},Le);function Le(){return null!==Ue&&Ue.apply(this,arguments)||this}var He,$e=(J(Fe,He=Be),Fe.prototype.create=function(){return 0},Fe.prototype.convert=function(t,e,n,r){var o=null==t?t:this.type(t);return o!=o&&this._log("error","Type-R:InvalidNumber","Number attribute is assigned with an invalid number",t,n,r.logger),o},Fe.prototype.validate=function(t,e,n){if(null!=e&&!isFinite(e))return n+" is not valid number"},Fe);function Fe(){return null!==He&&He.apply(this,arguments)||this}var We,ze=(J(qe,We=Ne),qe.prototype.toJSON=function(t){return t},qe.prototype.dispose=function(){},qe.prototype.create=function(){return[]},qe.prototype.convert=function(t,e,n,r){return null==t||Array.isArray(t)?t:(this._log("error","Type-R:InvalidArray","Array attribute assigned with non-array value",t,n,r.logger),[])},qe.prototype.clone=function(t){return t&&t.slice()},qe);function qe(){return null!==We&&We.apply(this,arguments)||this}var Ke,Ze=(J(Ge,Ke=Ne),Ge.prototype.create=function(){return{}},Ge.prototype.convert=function(t,e,n,r){return null==t||"object"==typeof t?t:(this._log("error","Type-R:InvalidObject","Object attribute is assigned with non-object value",t,n,r.logger),{})},Ge);function Ge(){return null!==Ke&&Ke.apply(this,arguments)||this}function Qe(){}var Xe,Ye=(J(tn,Xe=Ne),tn.prototype.toJSON=function(t){},tn.prototype.create=function(){return Qe},tn.prototype.dispose=function(){},tn.prototype.convert=function(t,e,n,r){return null==t||"function"==typeof t?t:(this._log("error","Type-R:InvalidFunction","Function attribute assigned with non-function value",t,n,r.logger),Qe)},tn.prototype.clone=function(t){return t},tn);function tn(){return null!==Xe&&Xe.apply(this,arguments)||this}var en,nn=(J(rn,en=Ne),rn.prototype.create=function(){return new Date},rn.prototype.convert=function(t,e,n,r){if(null==t||t instanceof Date)return t;var o=new Date(t),i=o.getTime();return i!=i&&this._log("error","Type-R:InvalidDate","Date attribute assigned with invalid date",t,n,r.logger),o},rn.prototype.validate=function(t,e,n){if(null!=e){var r=e.getTime();if(r!=r)return n+" is Invalid Date"}},rn.prototype.toJSON=function(t){return t&&t.toISOString()},rn.prototype.isChanged=function(t,e){return(t&&t.getTime())!==(e&&e.getTime())},rn.prototype.doInit=function(t,e,n){return this.transform(void 0===t?this.defaultValue():t,void 0,e,n)},rn.prototype.doUpdate=function(t,e,n,r){var o=this.name,i=e.attributes,s=i[o];return this.isChanged(s,i[o]=this.transform(t,s,e,n))},rn.prototype.clone=function(t){return t&&new Date(t.getTime())},rn.prototype.dispose=function(){},rn);function rn(){return null!==en&&en.apply(this,arguments)||this}function on(t){return!isNaN(new Date(t).getTime())}on("2011-11-29T15:52:30.5")&&on("2011-11-29T15:52:30.52")&&on("2011-11-29T15:52:18.867")&&on("2011-11-29T15:52:18.867Z")&&on("2011-11-29T15:52:18.867-03:30")||(nn.prototype.convert=function(t){return null==t||t instanceof Date?t:new Date(function(t){var e,n,r=0;if(n=an.exec(t)){for(var o,i=0;o=sn[i];++i)n[o]=+n[o]||0;n[2]=(+n[2]||1)-1,n[3]=+n[3]||1,"Z"!==n[8]&&void 0!==n[9]&&(r=60*n[10]+n[11],"+"===n[9]&&(r=0-r)),e=Date.UTC(n[1],n[2],n[3],n[4],n[5]+r,n[6],n[7])}else e=Date.parse(t);return e}(t))});var sn=[1,4,5,6,7,10,11],an=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/;var un,cn=ye.free,ln=ye.aquire,pn=(J(hn,un=Ne),hn.prototype.clone=function(t){return t?t.clone():t},hn.prototype.toJSON=function(t,e,n){return t&&t.toJSON(n)},hn.prototype.doInit=function(t,e,n){var r=n.clone?this.clone(t):void 0===t?this.defaultValue():t,o=this.transform(r,void 0,e,n);return this.handleChange(o,void 0,e,n),o},hn.prototype.doUpdate=function(t,e,n,r){var o,i=this.name,s=e.attributes,a=s[i];if(o=this.canBeUpdated(a,t,n)){var u=a._createTransaction(o,n);return u&&(r?r.push(u):u.commit(e),this.propagateChanges)?!0:!1}var c=this.transform(t,a,e,n);return s[i]=c,!!this.isChanged(c,a)&&(this.handleChange(c,a,e,n),!0)},hn.prototype.canBeUpdated=function(t,e,n){if(t&&null!=e){if(!(e instanceof this.type))return e;if(n.merge)return e.__inner_state__}},hn.prototype.convert=function(t,e,n,r){return null==t?t:t instanceof this.type?(!t._shared||t._shared&s.ItemsBehavior.persistent||this._log("error","Type-R:InvalidCollection","aggregated collection attribute is assigned with shared collection type",t,n,r.logger),r.merge?t.clone():t._owner?(this._log("warn","Type-R:InvalidOwner","object alreay has an owner and was cloned. Use explicit object.clone() to dismiss this warning.",t,n,r.logger),t.clone()):t):this.type.create(t,r)},hn.prototype.dispose=function(t,e){e&&this.handleChange(void 0,e,t,{})},hn.prototype.validate=function(t,e){var n=e&&e.validationError;if(n)return n},hn.prototype.create=function(){return this.type.create()},hn.prototype.initialize=function(t){t.changeHandlers.unshift(this._handleChange)},hn.prototype._handleChange=function(t,e,n,r){e&&(cn(n,e),r.unset||e.dispose()),t&&ln(n,t,this.name)},hn);function hn(){return null!==un&&un.apply(this,arguments)||this}var fn,dn=P,vn=T,yn=ye.free,gn=ye.aquire,mn=s.ItemsBehavior.listen|s.ItemsBehavior.share,bn=(J(_n,fn=Ne),_n.prototype.doInit=function(t,e,n){var r=n.clone?this.clone(t,e):void 0===t?this.defaultValue():t,o=this.transform(r,void 0,e,n);return this.handleChange(o,void 0,e,n),o},_n.prototype.doUpdate=function(t,e,n,r){var o,i=this.name,s=e.attributes,a=s[i];if(o=this.canBeUpdated(a,t,n)){var u=a._createTransaction(o,n);return u&&(r?r.push(u):u.commit(e),this.propagateChanges)?!0:!1}var c=this.transform(t,a,e,n);return s[i]=c,!!this.isChanged(c,a)&&(this.handleChange(c,a,e,n),!0)},_n.prototype.clone=function(t,e){if(!t||t._owner!==e)return t;var n=t.clone();return gn(e,n,this.name),n},_n.prototype.toJSON=function(){},_n.prototype.canBeUpdated=function(t,e,n){if(t&&null!=e&&!(e instanceof this.type))return e},_n.prototype.convert=function(t,e,n,r){if(null==t||t instanceof this.type)return t;var o=new this.type(t,r,mn);return gn(n,o,this.name),o},_n.prototype.validate=function(t,e,n){},_n.prototype.create=function(){return null},_n.prototype._handleChange=function(t,e,n,r){e&&(e._owner===n?(yn(n,e),r.unset||e.dispose()):vn(e,e._changeEventName,this._onChange,n)),t&&t._owner!==n&&dn(t,t._changeEventName,this._onChange,n)},_n.prototype.dispose=function(t,e){e&&this.handleChange(void 0,e,t,{})},_n.prototype.initialize=function(t){var r=this;this._onChange=this.propagateChanges?function(t,e,n){this===n||this.forceAttributeChange(r.name,e)}:On,t.changeHandlers.unshift(this._handleChange)},_n);function _n(){return null!==fn&&fn.apply(this,arguments)||this}function On(){}var wn=[String,Number,Boolean,Date,Object,Array,Function],jn=[Be,$e,Be,nn,Ze,ze,Ye];function Cn(t){return t._metatype||(e=t,(n=wn.indexOf(e))<0?Je:jn[n]);var e,n}Ne.create=function(t,e){var n=t.type;return new(t._metatype||(n?Cn(n):Ne))(e,t)};var An=c,En=(Pn.prototype.check=function(o,i){function r(t,e,n){if(!o.call(t,e,n)){var r=i||o.error||n+" is not valid";return"function"==typeof r?r.call(t,n):r}}var s=this.options.validate;return this.metadata({validate:s?function(t,e,n){return s(t,e,n)||r(t,e,n)}:r})},Object.defineProperty(Pn.prototype,"as",{get:function(){return z("attributes",this)},enumerable:!0,configurable:!0}),Object.defineProperty(Pn.prototype,"isRequired",{get:function(){return this.required},enumerable:!0,configurable:!0}),Object.defineProperty(Pn.prototype,"required",{get:function(){return this.metadata({isRequired:!0})},enumerable:!0,configurable:!0}),Pn.prototype.endpoint=function(t){return this.metadata({endpoint:t})},Pn.prototype.watcher=function(t){return this.metadata({_onChange:t})},Pn.prototype.onChange=function(n){return this.metadata({_onChange:function(t,e){n(this,t,e)}})},Pn.prototype.parse=function(t){return this.metadata({parse:t})},Pn.prototype.toJSON=function(t){return this.metadata({toJSON:"function"==typeof t?t:t?function(t,e,n){return t&&t.toJSON(n)}:Sn})},Object.defineProperty(Pn.prototype,"dontSave",{get:function(){return this.toJSON(!1)},enumerable:!0,configurable:!0}),Object.defineProperty(Pn.prototype,"null",{get:function(){return this.value(null)},enumerable:!0,configurable:!0}),Pn.prototype.get=function(t){return this.metadata({getHooks:this.options.getHooks.concat(t)})},Pn.prototype.set=function(i){return this.metadata({transforms:this.options.transforms.concat(function(t,e,n,r){if(this.isChanged(t,e)){var o=i.call(n,t,this.name);return void 0===o?e:this.convert(o,e,n,r)}return e})})},Pn.prototype.changeEvents=function(t){return this.metadata({changeEvents:t})},Pn.prototype.events=function(t){var r=new b(t);return this.metadata({changeHandlers:this.options.changeHandlers.concat(function(t,e,n){e&&e.trigger&&r.unsubscribe(n,e),t&&t.trigger&&r.subscribe(n,t)})})},Object.defineProperty(Pn.prototype,"has",{get:function(){return this},enumerable:!0,configurable:!0}),Pn.prototype.metadata=function(t){var e=new Pn(this.options);return An(e.options,t),e},Pn.prototype.value=function(t){return this.metadata({value:t,hasCustomDefault:!0})},Pn.from=function(t){return null},Pn);function Pn(t){this.options={getHooks:[],transforms:[],changeHandlers:[]},t&&An(this.options,t)}function Sn(){}function Tn(t,e){if(t instanceof En)return t;var n=new En({type:t}),r=t&&void 0===e?Cn(t).defaultValue:e;return void 0===r?n:n.value(r)}function kn(t){return new En({value:null,type:t,_metatype:bn})}function Nn(t){var e=function(t){switch(typeof t){case"number":return Number;case"string":return String;case"boolean":return Boolean;case"function":return Function;case"undefined":return;case"object":return t?t.constructor:void 0}}(t);return(e&&e.prototype instanceof de?kn:Tn)(e).value(t)}var xn=Symbol("Methods definitions"),Dn=Symbol("Methods definitions");var In,Rn=(J(Mn,In=s.Linked),Mn.prototype.set=function(t){this.model[this.attr]=t},Object.defineProperty(Mn.prototype,"error",{get:function(){return this._error||(this._error=this.model.getValidationError(this.attr))},set:function(t){this._error=t},enumerable:!0,configurable:!0}),Object.defineProperty(Mn.prototype,"descriptor",{get:function(){return this.model._attributes[this.attr]},enumerable:!0,configurable:!0}),Mn);function Mn(t,e,n,r){var o=In.call(this,n)||this;return o.model=t,o.attr=e,o._token=r,o}function Jn(t,e){return Ne.create(En.from(t).options,e)}function Vn(t,e){var n=u({},t,Jn),r=a({},n,e),o=function(t){var e=Object.keys(t),n=new Function("values","\n        "+e.map(function(t){return"\n            this."+t+" = values."+t+";\n        "}).join("")+"\n    ");n.prototype=Object.prototype;var r=new Function("record","values","options","\n        var _attrs = record._attributes;\n\n        "+e.map(function(t){return"\n            this."+t+" = _attrs."+t+".doInit( values."+t+", record, options );\n        "}).join("")+"\n    ");return r.prototype=Object.prototype,{Attributes:r,AttributesCopy:n}}(r);return V(V(V(V({},o),{_attributes:new o.AttributesCopy(r),_attributesArray:Object.keys(r).map(function(t){return r[t]}),properties:u({},n,function(t){return t.createPropertyDescriptor()})}),function(t){var e;for(var n in t){var r=t[n].options._onChange;r&&(e=e||new b).addEvent("change:"+n,("string"==typeof r?function(t,n){var e=new kt(t,!0),r=e.local,o=e.resolve,i=e.tail;return r?function(t,e){t[i](e,n)}:function(t,e){o(t)[i](e,n)}}:function(n,r){return function(t,e){n.call(t,e,r)}})(r,n))}return e?{_localEvents:e}:{}}(n)),{_endpoints:u({},r,function(t){return t.options.endpoint})})}Object.defineProperty(Rn.prototype,"_changeToken",{value:null});var Un,Bn={save:function(e){var n=this;void 0===e&&(e={});var t=this.getEndpoint(),r=this.toJSON(V({ioMethod:"save"},e));return Et(this,this.isNew()?t.create(r,e,this):t.update(this.id,r,e,this),e,function(t){n.set(t,V({parse:!0,ioMethod:"save"},e))})},fetch:function(e){var n=this;return void 0===e&&(e={}),Et(this,this.getEndpoint().read(this.id,e,this),e,function(t){return n.set(t,V({parse:!0,ioMethod:"fetch"},e))})},destroy:function(e){var n=this;return void 0===e&&(e={}),Et(this,this.getEndpoint().destroy(this.id,e,this),e,function(){var t=n.collection;return t?t.remove(n,e):n.dispose(),n})}},Ln=c,Hn=e,$n=0,Fn=(J(Wn,Un=de),Wn.onDefine=function(t,e){},Wn.comparator=function(n,t){void 0===t&&(t=!0);var r=y;return t?function(t,e){return r(t[n],e[n])}:function(t,e){return-r(t[n],e[n])}},Object.defineProperty(Wn,"ref",{get:function(){var n=this;return Tn(this).toJSON(function(t){return t?t.id:null}).parse(function(t){var e={};return e[n.prototype.idAttribute]=t,e})},enumerable:!0,configurable:!0}),Wn.extendAttrs=function(t){return this.defaults(t)},Wn.defaults=function(t){return this.extend({attributes:t})},Object.defineProperty(Wn.prototype,"$",{get:function(){return this._attributes$||(this._attributes$=new this.__Attributes$(this))},enumerable:!0,configurable:!0}),Wn.prototype.previousAttributes=function(){return new this.AttributesCopy(this._previousAttributes)},Object.defineProperty(Wn.prototype,"__inner_state__",{get:function(){return this.attributes},enumerable:!0,configurable:!0}),Object.defineProperty(Wn.prototype,"changed",{get:function(){if(!(e=this._changedAttributes)){for(var t=this._previousAttributes,e={},n=this.attributes,r=0,o=this._attributesArray;r<o.length;r++){var i=o[r],s=i.name,a=n[s];i.isChanged(a,t[s])&&(e[s]=a)}this._changedAttributes=e}return e},enumerable:!0,configurable:!0}),Wn.prototype.changedAttributes=function(t){if(!t)return!!this.hasChanged()&&V({},this.changed);var e,n=!1,r=this._transaction?this._previousAttributes:this.attributes,o=this._attributes;for(var i in t)o[i].isChanged(r[i],e=t[i])&&((n=n||{})[i]=e);return n},Wn.prototype.hasChanged=function(t){var e=this._previousAttributes;return!!e&&(t?this._attributes[t].isChanged(this.attributes[t],e[t]):!Hn(this.changed))},Wn.prototype.previous=function(t){if(t){var e=this._previousAttributes;if(e)return e[t]}return null},Wn.prototype.isNew=function(){return null==this.id},Wn.prototype.has=function(t){return null!=this[t]},Wn.prototype.unset=function(t,e){var n,r=this[t];return this.set(((n={})[t]=void 0,n),V({unset:!0},e)),r},Wn.prototype.clear=function(t){var n=this,r=t&&t.nullify;return this.transaction(function(){n.forEach(function(t,e){return n[e]=r?null:void 0})},t),this},Wn.prototype.getOwner=function(){var t=this._owner;return this._ownerKey?t:t&&t._owner},Object.defineProperty(Wn.prototype,"id",{get:function(){return this.attributes[this.idAttribute]},set:function(t){Oe(this,this.idAttribute,t)},enumerable:!0,configurable:!0}),Wn.prototype.defaults=function(t){void 0===t&&(t={});for(var e={},n=0,r=this._attributesArray;n<r.length;n++){var o=r[n],i=o.name,s=t[i];e[i]=void 0===s?o.defaultValue():s}return e},Wn.prototype.initialize=function(t,e){},Wn.prototype.clone=function(t){void 0===t&&(t={});var e=new this.constructor(this.attributes,{clone:!0});return t.pinStore&&(e._defaultStore=this.getStore()),e},Wn.prototype._validateNested=function(t){for(var e=0,n=this.attributes,r=0,o=this._attributesArray;r<o.length;r++){var i=o[r],s=i.name,a=i.validate(this,n[s],s);a&&(t[s]=a,e++)}return e},Wn.prototype.get=function(t){return this[t]},Wn.prototype.set=function(t,e){var n;return!t||(n=this._createTransaction(t,e))&&n.commit(),this},Wn.prototype.toJSON=function(t){for(var e={},n=this.attributes,r=0,o=this._attributesArray;r<o.length;r++){var i,s=o[r],a=s.name,u=n[a];void 0===u||void 0!==(i=s.toJSON.call(this,u,a,t))&&(e[a]=i)}return e},Wn.prototype.parse=function(t,e){return t},Wn.prototype.deepSet=function(l,p,h){var f=this;return this.transaction(function(){for(var t,e=l.split("."),n=e.length-1,r=e[n],o=f,i=0;i<n;i++){var s=e[i],a=o.get?o.get(s):o[s];if(!a){var u=o._attributes;if(!u)return;var c=u[s].create();h&&h.nullify&&c._attributes&&c.clear(h),o[s]=a=c}o=a}o.set?o.set(((t={})[r]=p,t),h):o[r]=p}),this},Object.defineProperty(Wn.prototype,"collection",{get:function(){return this._ownerKey?null:this._owner},enumerable:!0,configurable:!0}),Wn.prototype.dispose=function(){if(!this._disposed){for(var t=this.attributes,e=0,n=this._attributesArray;e<n.length;e++){var r=n[e];r.dispose(this,t[r.name])}Un.prototype.dispose.call(this)}},Wn.prototype._log=function(t,e,n,r,o){(o||_t).trigger(t,e,this.getClassName()+" "+n,V(V({},r),{Model:this,"Attributes definition":this._attributes}))},Wn.prototype.getClassName=function(){return Un.prototype.getClassName.call(this)||"Model"},Wn.prototype._createTransaction=function(t,e){},Wn.prototype.forEach=function(n,r){var t=void 0!==r?function(t,e){return n.call(r,t,e)}:n,e=this.attributes;for(var o in this.attributes){var i=e[o];void 0!==i&&t(i,o)}},Wn.prototype.mapObject=function(t,e){var n=void 0===e?t:t.bind(e);return u({},this.attributes,n)},Wn.prototype[Symbol.iterator]=function(){return new Zn(this)},Wn.prototype.entries=function(){return new Zn(this)},Wn.prototype.keys=function(){var n=[];return this.forEach(function(t,e){return n.push(e)}),n},Wn._metatype=pn,Wn.id=Tn(String).value(null),B([F({cidPrefix:"m",_changeEventName:"change",idAttribute:"id"}),W({defaults:Q.merge,attributes:Q.merge,collection:Q.merge,Collection:Q.value,idAttribute:Q.protoValue})],Wn));function Wn(t,e){var n=Un.call(this,$n++)||this;n._attributes$=void 0,n.attributes={};var r=e||{},o=(r.parse?n.parse(t,r):t)||{};return vt||function(t,e,n){if(Ee(t,e,n)){var r=t._attributes,o=void 0;for(var i in e)r[i]||(o=o||[]).push("'"+i+"'");o&&Ae(t,o,{values:e},n)}}(n,o,r),n._previousAttributes=n.attributes=new n.Attributes(n,o,r),n.initialize(t,e),n._localEvents&&n._localEvents.subscribe(n,n),n}Ln(Fn.prototype,Ce,Bn);function zn(t,e,n){this.id=e.id}Fn.prototype.Attributes=zn;function qn(t){this.id=t.id}Fn.prototype.AttributesCopy=qn;var Kn=Ne.create({value:void 0},"id");Fn.prototype._attributes={id:Kn},Fn.prototype._attributesArray=[Kn];var Zn=(Gn.prototype.next=function(){var t=this.record,e=t._attributesArray[this.idx++];return{done:!e,value:e?[e.name,t[e.name]]:void 0}},Gn);function Gn(t){this.record=t,this.idx=0}var Qn=c,Xn=a;function Yn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n,r,o,i,s,a=(n=t[t.length-1],r=n[Dn],o=n[xn],i=U(n,["symbol"==typeof Dn?Dn:Dn+"","symbol"==typeof xn?xn:xn+""]),V({attributes:i,collection:o},r)),u=1<t.length?t[0]:null,c=2<t.length?t.slice(1,t.length-1):null,l=(J(p,s=u||Fn),p);function p(){return null!==s&&s.apply(this,arguments)||this}return c&&G(c)(l),F(a)(l),l}Fn.onExtend=function(t){de.onExtend.call(this,t);var e,n=this,r=(J(o,e=t.Collection),o.model=n,B([$],o));function o(){return null!==e&&e.apply(this,arguments)||this}this.DefaultCollection=r,n.Collection===t.Collection&&(this.Collection=r)},Fn.onDefine=function(t,e){var n=e.prototype,r=Vn(this.attributes=function(t){var e=t.defaults,n=t.attributes,r=t.idAttribute,o=n||e||{};!r||r in o||(o[r]=void 0);return o}(t),n._attributes),o=r.properties,i=r._localEvents,s=U(r,["properties","_localEvents"]);Qn(this.prototype,s),t.properties=Xn(t.properties||{},o),t._localEvents=i,de.onDefine.call(this,t,e),this.DefaultCollection.define(t.collection||{}),this.Collection=t.Collection,this.Collection.prototype.model=this,t.endpoint&&(this.Collection.prototype._endpoint=t.endpoint),function(t){var e=t.prototype,n=e._attributesArray,r=new Function("model","\n        this._model = model;\n        "+n.map(function(t){return"this.$"+t.name+" = void 0; "}).join("\n")+"\n    ");r.prototype.__ModelAttrRef=Rn;for(var o=0,i=n;o<i.length;o++){var s=i[o],a=s.name;Object.defineProperty(r.prototype,a,{get:new Function(s.isMutableType()?"\n                var cached = this.$"+a+",\n                    value = this._model."+a+",\n                    token = value && value._changeToken;\n\n                return cached && cached._token === token ? cached :\n                    ( this.$"+a+" = new this.__ModelAttrRef( this._model, '"+a+"', value, token ) );\n            ":"\n                var cached = this.$"+a+";\n\n                return cached && cached.value === this._model."+a+" ? cached :\n                    ( this.$"+a+" = new this.__ModelAttrRef( this._model, '"+a+"', this._model."+a+" ) );\n            ")})}e.__Attributes$=r}(this)};var tr=x,er=D,nr=P,rr=T,or=ye.commit,ir=ye.aquire,sr=ye.free;function ar(t,e,n){var r,o=t.model;t._shared?(r=e instanceof o?e:o.create(e,n),t._shared&s.ItemsBehavior.listen&&nr(r,r._changeEventName,t._onChildrenChange,t)):(r=e instanceof o?n.merge?e.clone():e:o.create(e,n))._owner?r._owner!==t&&(ir(t,r.clone()),(t._aggregationError||(t._aggregationError=[])).push(r)):ir(t,r);var i=t._itemEvents;return i&&i.subscribe(t,r),r}function ur(t,e,n){t._shared?t._shared&s.ItemsBehavior.listen&&rr(e,e._changeEventName,t._onChildrenChange,t):(sr(t,e),n||e.dispose());var r=t._itemEvents;r&&r.unsubscribe(t,e)}function cr(t,e){var n=t._comparator;return!(!n||!1===e.sort)&&(t.models.sort(n),!0)}function lr(t,e){var n=(t[e.cid]=e).id;!n&&0!==n||(t[n]=e)}function pr(t,e){delete t[e.cid];var n=e.id;!n&&0!==n||delete t[n]}function hr(t,e){delete t[e.previous(e.idAttribute)];var n=e.id;null==n||(t[n]=e)}var fr=(dr.prototype.commit=function(t){for(var e=this.nested,n=this.object,r=n._isDirty,o=0,i=e;o<i.length;o++){(u=i[o]).commit(n)}n._aggregationError&&vr(n,r);for(var s=0,a=e;s<a.length;s++){var u=a[s];tr(n,"change",u.object,r)}for(var c=this.added,l=this.removed,p=0,h=c;p<h.length;p++){var f=h[p];er(f,"add",f,n,r),er(n,"add",f,n,r)}for(var d=0,v=l;d<v.length;d++){f=v[d];er(f,"remove",f,n,r),er(n,"remove",f,n,r)}this.sorted&&tr(n,"sort",n,r),(c.length||l.length)&&tr(n,"update",n,r),this.isRoot&&or(n,t)},dr);function dr(t,e,n,r,o,i){this.object=t,this.isRoot=e,this.added=n,this.removed=r,this.nested=o,this.sorted=i}function vr(t,e){t._log("warn","Type-R:InvalidOwner","added records already have an owner and were cloned. Use explicit record.clone() to dismiss this warning.",t._aggregationError,e.logger),t._aggregationError=void 0}var yr=ye.begin,gr=ye.commit,mr=ye.markAsDirty;function br(t,e,n,r){var o=yr(t),i=[],s=function(t,e,n,r,o){for(var i=t._byId,s=t.models,a=(o||r.merge)&&!t._shared,u=(r.parse,t.model.prototype.idAttribute),c=s.length,l=0,p=e;l<p.length;l++){var h,f,d=p[l],v=d?i[d[u]]||i[d.cid]:null;v?a&&d!==v&&(h=d.attributes||d,(f=v._createTransaction(h,r))&&n.push(f),v.hasChanged(u)&&hr(i,v)):(v=ar(t,d,r),s.push(v),lr(i,v))}return s.slice(c)}(t,e,i,n,r);if(s.length||i.length){var a=function(t,e,n){var r=n.at;if(null==r)return cr(t,n);var o=t.models.length-e.length;(r=Number(r))<0&&(r+=1+o);r<0&&(r=0);o<r&&(r=o);return function(t,e,n){for(var r=t.length-1,o=r-n.length;e<=o;o--,r--)t[r]=t[o];for(o=0,r=e;o<n.length;o++,r++)t[r]=n[o]}(t.models,r,e),!1}(t,s,n);if(mr(t,n))return new fr(t,o,s,[],i,a);t._aggregationError&&vr(t,n)}o&&gr(t)}var _r=(Or.prototype.map=function(t,e){for(var n=this.models,r=n.length,o=Array(r),i=e?t.bind(e):t,s=0,a=0;s<r;s++){var u=i(n[s],s);void 0===u||(o[a++]=u)}return s!==a&&(o.length=a),o},Or.prototype.each=function(t,e){for(var n=this.models,r=n.length,o=e?t.bind(e):t,i=0;i<r;i++)o(n[i],i)},Or.prototype.firstMatch=function(t,e){for(var n=this.models,r=n.length,o=e?t.bind(e):t,i=0;i<r;i++){var s=o(n[i],i);if(void 0!==s)return s}},Or.prototype.reduce=function(t,e){return void 0===e?this.models.reduce(t):this.models.reduce(t,e)},Or.prototype.slice=function(t,e){return this.models.slice(t,e)},Or.prototype.indexOf=function(t){return this.models.indexOf(this.get(t))},Or.prototype.includes=function(t){return Boolean(this.get(t))},Or.prototype.filter=function(t,e){var n=Cr(t);return this.map(function(t){return n(t)?t:void 0},e)},Or.prototype.find=function(t,e){var n=Cr(t);return this.firstMatch(function(t){return n(t)?t:void 0},e)},Or.prototype.some=function(t,e){return Boolean(this.find(t,e))},Or.prototype.forEach=function(t,e){this.each(t,e)},Or.prototype.values=function(){return this.models.values()},Or.prototype.entries=function(){return this.models.entries()},Or.prototype.every=function(t,e){var n=Cr(t);return void 0===this.firstMatch(function(t){return!!n(t)&&void 0},e)},Or.prototype.pluck=function(e){return this.map(function(t){return t[e]})},Or.prototype.first=function(){return this.models[0]},Or.prototype.last=function(){return this.models[this.models.length-1]},Or.prototype.at=function(t){var e=t<0?t+this.models.length:t;return this.models[e]},Or.prototype.groupBy=function(e,t){for(var n="string"==typeof e?function(t){return t[e]}:e,r=t||wr,o={},i=0,s=this.models;i<s.length;i++){var a=s[i],u=n(a);null!=u&&(o[u]=r(o[u],a,u))}return o},Or);function Or(){}var wr=function(t,e){return void 0===t&&(t=[]),t.push(e),t},jr=function(t){return t};function Cr(o){if(null==o)return jr;switch(typeof o){case"function":return o;case"object":var i=Object.keys(o);return function(t){for(var e=0,n=i;e<n.length;e++){var r=n[e];if(o[r]!==t[r])return!1}return!0};default:throw new Error("Invalid iteratee")}}var Ar=x,Er=D,Pr=ye.markAsDirty,Sr=ye.begin,Tr=ye.commit;function kr(t,e,n){var r,o=function(t,e,n){for(var r=Array(e.length),o=t._byId,i=0,s=0;i<e.length;i++){var a=t.get(e[i]);a&&(r[s++]=a,pr(o,a),ur(t,a,n))}return r.length=s,r}(t,e,n.unset);return o.length&&(r=Sr(t),function(t,e){for(var n=t.models,r=t.models=Array(n.length-e),o=t._byId,i=0,s=0;i<n.length;i++){var a=n[i];o[a.cid]&&(r[s++]=a)}r.length=s}(t,o.length),Pr(t,n)?new fr(t,r,[],o,[],!1).commit():r&&Tr(t)),o}var Nr=ye.begin,xr=ye.commit,Dr=ye.markAsDirty,Ir={silent:!0};function Rr(t,e,n,r){var o=Nr(t),i=function(t,e,n){for(var r=e?e.length:0,o=Array(r),i={},s=t.model.prototype.idAttribute,a=0,u=0;a<r;a++){var c,l=e[a];l&&(i[l[s]]||i[l.cid])||(c=ar(t,l,n),o[u++]=c,lr(i,c))}return o.length=u,t._byId=i,t.models=o}(t,e,n);if(i.length){var s=cr(t,n);if(Dr(t,r?Ir:n))return new fr(t,o,i.slice(),[],[],s);t._aggregationError&&vr(t,n)}o&&xr(t)}function Mr(t,e,n){var r=Nr(t),o=[],i=t.models,s=function(t,e,n,r){for(var o=Array(e.length),i={},s=(null==r.merge||r.merge)&&!t._shared,a=t._byId,u=t.models,c=t.model.prototype.idAttribute,l=[],p=!0,h=0,f=0;h<e.length;h++){var d,v,y=e[h],g=null;if(y){var m=y[c],b=y.cid;if(i[m]||i[b])continue;g=a[m]||a[b]}g?s&&y!==g&&(p&&u[f]!==g&&(p=!1),d=y.attributes||y,(v=g._createTransaction(d,r))&&n.push(v)):(g=ar(t,y,r),l.push(g)),o[f++]=g,lr(i,g)}o.length=f,t.models=o,t._byId=i,p||(r.sorted=!0);return l}(t,e,o,n),a=t.models.length-s.length,u=a<i.length?(a?function(t,e){for(var n=t._byId,r=[],o=0,i=e;o<i.length;o++){var s=i[o];n[s.cid]||(r.push(s),ur(t,s))}return r}:function(t,e){for(var n=0,r=e;n<r.length;n++){ur(t,r[n])}return e})(t,i):[],c=o.length||s.length,l=cr(t,n)&&c||s.length||n.sorted;if(c||u.length||l){if(Dr(t,n))return new fr(t,r,s,u,o,l);t._aggregationError&&vr(t,n)}r&&xr(t)}var Jr,Vr=x,Ur=ye.begin,Br=ye.commit,Lr=ye.markAsDirty,Hr=0,$r=(J(Fr,Jr=bn),Fr.defaultValue=[],Fr);function Fr(){return null!==Jr&&Jr.apply(this,arguments)||this}var Wr,zr,qr=(J(Kr,Wr=de),(zr=Kr).of=function(t){return"function"==typeof t?t.Collection:Yn(t).Collection},Kr.ofRefs=function(t){return t.Collection.Refs},Kr.prototype.createSubset=function(t,e){throw new ReferenceError("Failed dependency injection")},Kr.onExtend=function(t){var r=this;function e(t,e,n){r.call(this,t,e,s.ItemsBehavior.share|(n?s.ItemsBehavior.listen:0))}this._SubsetOf=null,L.mixins.populate(e),e.create=zr.create,e.prototype=this.prototype,e._metatype=$r,this.Refs=this.Subset=e,de.onExtend.call(this,t)},Kr.onDefine=function(t,e){var n;t.itemEvents&&((n=new b(e.prototype._itemEvents)).addEventsMap(t.itemEvents),this.prototype._itemEvents=n),void 0!==t.comparator&&(this.prototype.comparator=t.comparator),de.onDefine.call(this,t)},Object.defineProperty(Kr.prototype,"__inner_state__",{get:function(){return this.models},enumerable:!0,configurable:!0}),Object.defineProperty(Kr.prototype,"comparator",{get:function(){return this._comparator},set:function(o){var i=this;switch(typeof o){case"string":this._comparator=function(t,e){var n=t[o],r=e[o];return n===r?0:n<r?-1:1};break;case"function":1===o.length?this._comparator=function(t,e){var n=o.call(i,t),r=o.call(i,e);return n===r?0:n<r?-1:1}:this._comparator=function(t,e){return o.call(i,t,e)};break;default:this._comparator=null}},enumerable:!0,configurable:!0}),Kr.prototype.getStore=function(){return this._store||(this._store=this._owner?this._owner.getStore():this._defaultStore)},Kr.prototype._onChildrenChange=function(t,e,n){var r,o;void 0===e&&(e={}),n!==this&&(r=this.idAttribute,t.hasChanged(r)&&hr(this._byId,t),o=Ur(this),Lr(this,e)&&Vr(this,"change",t,e),o&&Br(this))},Kr.prototype.get=function(t){if(null!=t){if("object"!=typeof t)return this._byId[t];var e=t[this.idAttribute];return void 0!==e&&this._byId[e]||this._byId[t.cid]}},Kr.prototype[Symbol.iterator]=function(){return this.models[Symbol.iterator]()},Kr.prototype.updateEach=function(t){var e=ye.begin(this);this.each(t),e&&ye.commit(this)},Kr.prototype._validateNested=function(n){if(this._shared)return 0;var r=0;return this.each(function(t){var e=t.validationError;e&&(n[t.cid]=e,r++)}),r},Kr.prototype.initialize=function(){},Kr.prototype.clone=function(t){void 0===t&&(t={});var e=this._shared&s.ItemsBehavior.share?this.models:this.map(function(t){return t.clone()}),n=new this.constructor(e,{model:this.model,comparator:this.comparator},this._shared);return t.pinStore&&(n._defaultStore=this.getStore()),n},Kr.prototype.toJSON=function(e){return this.map(function(t){return t.toJSON(e)})},Kr.prototype.set=function(t,e){var n;return void 0===t&&(t=[]),void 0===e&&(e={}),void 0!==e.add&&this._log("warn","Type-R:InvalidOption","Collection.set doesn't support 'add' option, behaving as if options.add === true.",e),e.reset?this.reset(t,e):(n=this._createTransaction(t,e))&&n.commit(),this},Kr.prototype.liveUpdates=function(t){var e=this;if(t){this.liveUpdates(!1);var n="function"==typeof t?t:function(){return!0};return this._liveUpdates={updated:function(t){n(t)&&e.add(t,{parse:!0,merge:!0})},removed:function(t){return e.remove(t)}},this.getEndpoint().subscribe(this._liveUpdates,this).then(function(){return e})}this._liveUpdates&&(this.getEndpoint().unsubscribe(this._liveUpdates,this),this._liveUpdates=null)},Kr.prototype.fetch=function(t){var n=this;void 0===t&&(t={});var r=V({parse:!0},t),e=this.getEndpoint();return Et(this,e.list(r,this),r,function(t){var e=n.set(t,V({parse:!0,ioMethod:"fetch"},r));return r.liveUpdates&&(e=n.liveUpdates(r.liveUpdates)),e})},Kr.prototype.dispose=function(){if(!this._disposed){for(var t=!this._shared,e=0,n=this.models;e<n.length;e++){var r=n[e];ur(this,r),t&&r.dispose()}this.liveUpdates(!1),Wr.prototype.dispose.call(this)}},Kr.prototype.reset=function(t,e){void 0===e&&(e={});var n=Ur(this),r=this.models;t?Rr(this,Zr(this,t,e),e,!0):(this._byId={},this.models=[]),Lr(this,e),e.silent||Vr(this,"reset",this,V({previousModels:r},e));for(var o=this._byId,i=0,s=r;i<s.length;i++){var a=s[i];o[a.cid]||ur(this,a)}return n&&Br(this),this.models},Kr.prototype.add=function(t,e){void 0===e&&(e={});var n=Zr(this,t,e),r=(this.models.length?br:Rr)(this,n,e);if(r)return r.commit(),r.added},Kr.prototype.remove=function(t,e){return void 0===e&&(e={}),t?(Array.isArray(t)?kr:function(t,e,n){var r=t.get(e);if(r){var o=Sr(t),i=t.models;i.splice(i.indexOf(r),1),pr(t._byId,r);var s=Pr(t,n);return s&&(Er(r,"remove",r,t,n),Er(t,"remove",r,t,n)),ur(t,r,n.unset),s&&Ar(t,"update",t,n),o&&Tr(t),r}})(this,t,e):[]},Kr.prototype.$includes=function(t){return new Qr(this,t)},Kr.prototype._createTransaction=function(t,e){void 0===e&&(e={});var n=Zr(this,t,e);return this.models.length?!1===e.remove?br(this,n,e,!0):Mr(this,n,e):Rr(this,n,e)},Kr.prototype.sort=function(t){var e;return void 0===t&&(t={}),cr(this,t)&&(e=Ur(this),Lr(this,t)&&Vr(this,"sort",this,t),e&&Br(this)),this},Kr.prototype.unset=function(t,e){var n=this.get(t);return this.remove(t,V({unset:!0},e)),n},Kr.prototype.modelId=function(t){return t[this.model.prototype.idAttribute]},Kr.prototype.toggle=function(t,e){var n=Boolean(this.get(t)),r=void 0===e?!n:Boolean(e);return n!==r&&(n?this.remove(t):this.add(t)),r},Kr.prototype._log=function(t,e,n,r,o){(o||_t).trigger(t,e,this.model.prototype.getClassName()+"."+this.getClassName()+": "+n,{Argument:r,"Attributes spec":this.model.prototype._attributes})},Kr.prototype.getClassName=function(){return Wr.prototype.getClassName.call(this)||"Collection"},Object.defineProperty(Kr.prototype,"length",{get:function(){return this.models.length},enumerable:!0,configurable:!0}),Kr.prototype.push=function(t,e){return this.add(t,V({at:this.length},e))},Kr.prototype.pop=function(t){var e=this.at(this.length-1);return this.remove(e,V({unset:!0},t)),e},Kr.prototype.unshift=function(t,e){return this.add(t,V({at:0},e))},Kr.prototype.shift=function(t){var e=this.at(0);return this.remove(e,V({unset:!0},t)),e},Kr.refsTo=kn,Kr._metatype=pn,zr=B([F({cidPrefix:"c",model:Fn,_changeEventName:"changes",_aggregationError:null}),G(_r),W({comparator:Q.value,model:Q.protoValue,itemEvents:Q.merge})],Kr));function Kr(t,e,n){void 0===e&&(e={});var r=Wr.call(this,Hr++)||this;return r.models=[],r._byId={},r.comparator=r.comparator,void 0!==e.comparator&&(r.comparator=e.comparator,e.comparator=void 0),r.model=r.model,e.model&&(r.model=e.model,e.model=void 0),r.idAttribute=r.model.prototype.idAttribute,r._shared=n||0,t&&Rr(r,Zr(r,t,e),e,!0),r.initialize.apply(r,arguments),r._localEvents&&r._localEvents.subscribe(r,r),r}function Zr(t,e,n){var r=n.parse?t.parse(e,n):e;return Array.isArray(r)?r:[r]}Fn.Collection=qr;var Gr,Qr=(J(Xr,Gr=s.Linked),Xr.prototype.set=function(t){this.collection.toggle(this.model)},Xr);function Xr(t,e){var n=Gr.call(this,t.get(e))||this;return n.collection=t,n.model=e,n}function Yr(e){switch(typeof e){case"function":return function(t){return e.call(t,t)};case"object":return function(){return e};case"string":return new kt(e).resolve}}var to,eo=(J(no,to=Ne),no.prototype.toJSON=function(t){return t&&"object"==typeof t?t.id:t},no.prototype.clone=function(t){return t&&"object"==typeof t?t.id:t},no.prototype.isChanged=function(t,e){return(t&&(null==t.id?t:t.id))!==(e&&(null==e.id?e:e.id))},no.prototype.validate=function(t,e,n){},no);function no(){return null!==to&&to.apply(this,arguments)||this}function ro(t,e){var o=Yr(t);return new En({value:null,_metatype:eo}).get(function(t,e){if("object"==typeof t)return t;var n=o(this),r=null;return n&&n.length&&(r=n.get(t)||null,(this.attributes[e]=r)&&this._attributes[e].handleChange(r,null,this,{})),r})}function oo(t,e){var n,r=e||qr,o=r._SubsetOf||(r._SubsetOf=((n=function(i){function t(t,e){var n=i.call(this,[],e,io)||this;return n.resolvedWith=null,n.refs=uo(t),n}return J(t,i),Object.defineProperty(t.prototype,"__inner_state__",{get:function(){return this.refs||this.models},enumerable:!0,configurable:!0}),t.prototype.add=function(t,e){void 0===e&&(e={});var n,r=this.resolvedWith,o=uo(t);if(r)return i.prototype.add.call(this,so(r,o),e);o.length&&(n=ye.begin(this),this.refs=this.refs?this.refs.concat(o):o.slice(),ye.markAsDirty(this,e),n&&ye.commit(this))},t.prototype.reset=function(t,e){void 0===e&&(e={});var n=this.resolvedWith,r=uo(t);return n?i.prototype.reset.call(this,so(n,r),e):(ao(this,r,e),[])},t.prototype._createTransaction=function(t,e){var n=this.resolvedWith,r=uo(t);return n?i.prototype._createTransaction.call(this,so(n,r),e):ao(this,r,e)},t.prototype.toJSON=function(){return this.refs?this.refs.map(function(t){return t.id||t}):this.models.map(function(t){return t.id})},t.prototype._validateNested=function(){return 0},Object.defineProperty(t.prototype,"length",{get:function(){return this.models.length||(this.refs?this.refs.length:0)},enumerable:!0,configurable:!0}),t.prototype.clone=function(t){var e=new this.constructor([],{model:this.model,comparator:this.comparator});return this.resolvedWith?(e.resolvedWith=this.resolvedWith,e.refs=null,e.reset(this.models,{silent:!0})):e.refs=this.refs.slice(),e},t.prototype.parse=function(t){return t},t.prototype.resolve=function(t){return t&&t.length&&(this.resolvedWith=t,this.refs&&(this.reset(this.refs,{silent:!0}),this.refs=null)),this},t.prototype.getModelIds=function(){return this.toJSON()},t.prototype.toggle=function(t,e){return i.prototype.toggle.call(this,this.resolvedWith.get(t),e)},t.prototype.addAll=function(){if(this.resolvedWith)return this.set(this.resolvedWith.models),this.models;throw new Error("Cannot add elemens because the subset collection is not resolved yet.")},t.prototype.toggleAll=function(){return this.length?this.reset():this.addAll()},B([F],t)}(r)).prototype._itemEvents=void 0,n)),i=Yr(t);return Tn(o).get(function(t){return!t||t.resolvedWith||t.resolve(i(this)),t})}Fn.memberOf=ro,qr.subsetOf=oo,qr.prototype.createSubset=function(t,e){var n=new(oo(this,this.constructor).options.type)(t,e);return n.resolve(this),n};var io=s.ItemsBehavior.share|s.ItemsBehavior.persistent;function so(t,e){for(var n=[],r=0,o=e;r<o.length;r++){var i=o[r],s=t.get(i);s&&n.push(s)}return n}function ao(t,e,n){var r;f(t.refs,e)&&(r=ye.begin(t),t.refs=e.slice(),ye.markAsDirty(t,n),r&&ye.commit(t))}function uo(t){return t?Array.isArray(t)?t:[t]:[]}var co,lo=null,po=(J(ho,co=Fn),ho.prototype.getStore=function(){return this},ho.prototype.get=function(t){var e=this[t];return e||this===this._defaultStore?e:this._owner?this._owner.get(t):this._defaultStore.get(t)},Object.defineProperty(ho,"global",{get:function(){return lo},set:function(t){lo&&lo.dispose(),de.prototype._defaultStore=lo=t},enumerable:!0,configurable:!0}),ho);function ho(){return null!==co&&co.apply(this,arguments)||this}po.global=new po,"undefined"==typeof Symbol&&Object.defineProperty(window,"Symbol",{value:{iterator:"Symbol.iterator"},configurable:!0});var fo=pt.on,vo=pt.off,yo=pt.trigger,go=pt.once,mo=pt.listenTo,bo=pt.stopListening,_o=pt.listenToOnce;function Oo(t){return Array.isArray(t)?Tn(wo(t[0]).Collection):Tn(wo(t))}function wo(t){return null!=t&&Object.getPrototypeOf(t)===Object.prototype?Yn(t):t}En.from=function(t){return t&&t instanceof En?t:"function"==typeof t?Oo(t):Array.isArray(t)?1!==t.length||!t[0]||"function"!=typeof t[0]&&Object.getPrototypeOf(t[0])!==Object.prototype?(At("error","Type-R:WrongDeclaration","Since v4.1, [ ModelType ] and [{ attr1, attr2, }] declares collection of models. Use Array or value([ 1, 2, ... ]) to declare plain array attributes."),Nn(t)):Oo(t):t&&"object"==typeof t?Object.getPrototypeOf(t)!==Object.prototype?(At("error","Type-R:WrongDeclaration","Since v4.1, non-primitive values must be wrapped in value(...). All objects are treated as attribute specs and define nested models."),Nn(t)):e(t)?(At("error","Type-R:WrongDeclaration","Since v4.1, objects are treated as attribute specs and define nested models. Use Object or value({...}) for an object attribute type."),Nn(t)):Oo(t):Nn(t)},s.AggregatedType=pn,s.AnyType=Ne,s.ArrayType=ze,s.ChainableAttributeSpec=En,s.Class=L,s.Collection=qr,s.DateType=nn,s.EventMap=b,s.Events=pt,s.FunctionType=Ye,s.ImmutableClassType=Je,s.Logger=gt,s.Messenger=ct,s.Mixable=L,s.MixinsState=q,s.Model=Fn,s.NumericType=$e,s.ObjectType=Ze,s.PrimitiveType=Be,s.Record=Fn,s.SharedType=bn,s.Store=po,s.Transactional=de,s.abortIO=Pt,s.attributes=Yn,s.auto=function(t,e){if("undefined"!=typeof Reflect&&Reflect.getMetadata){if(!e){var n=t;return function(t,e){Tn(Reflect.getMetadata("design:type",t,e)).value(n).as(t,e)}}Tn(Reflect.getMetadata("design:type",t,e)).as(t,e)}else t._log("error","Type-R:MissingImport",'Add import "reflect-metadata"; as the first line of your app.')},s.collection=xn,s.createIOPromise=function(n){var r,o,e;function i(t){e=t}var t=new Promise(function(t,e){n(r=t,o=e,i)});return t.abort=function(){e?e(r,o):o(new Error("I/O Aborted"))},t},s.defaultStore="_defaultStore",s.define=F,s.definitionDecorator=z,s.definitions=W,s.doNothing=Qe,s.eventsApi=R,s.getMetatype=Cn,s.getOwnerEndpoint=function t(e){var n=e.collection;if(n)return t(n);if(e._owner){var r=e._owner._endpoints;return r&&r[e._ownerKey]}},s.isProduction=vt,s.listenTo=mo,s.listenToOnce=_o,s.log=At,s.logEvents=yt,s.logger=_t,s.memberOf=ro,s.metadata=Dn,s.mixinRules=Q,s.mixins=G,s.off=vo,s.on=fo,s.once=go,s.predefine=$,s.propertyListDecorator=function(n){return function(t,e){(t.hasOwnProperty(n)?t[n]:t[n]=(t[n]||[]).slice()).push(e)}},s.refTo=kn,s.shared=kn,s.startIO=Et,s.stopListening=bo,s.subsetOf=oo,s.throwingLogger=Ct,s.tools=m,s.transaction=function(o){return function(){for(var t,e=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return this.transaction(function(){t=o.apply(e,n)}),t}},s.transactionApi=ye,s.trigger=yo,s.triggerAndBubble=St,s.type=Oo,s.value=Nn,s.versionToken="_changeToken",Object.defineProperty(s,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
