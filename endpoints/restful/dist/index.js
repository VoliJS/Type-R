!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("type-r")):"function"==typeof define&&define.amd?define(["exports","type-r"],e):e((t=t||self).restfulIO={},t.Nested)}(this,function(t,e){"use strict";var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var c=function(){return(c=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function a(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&(r[n[o]]=t[n[o]])}return r}function o(i,s,u,c){return new(u||(u=Promise))(function(t,e){function r(t){try{o(c.next(t))}catch(t){e(t)}}function n(t){try{o(c.throw(t))}catch(t){e(t)}}function o(e){e.done?t(e.value):new u(function(t){t(e.value)}).then(r,n)}o((c=c.apply(i,s||[])).next())})}function i(r,n){var o,i,s,t,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,i&&(s=2&e[0]?i.return:e[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,e[1])).done)return s;switch(i=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,i=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=n.call(r,u)}catch(t){e=[6,t],i=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var l=function(){function t(t,e){this.delay=e,this.index=[0],this.items={};for(var r=0,n=t;r<n.length;r++){var o=n[r];this.create(o,{})}}return t.prototype.resolve=function(r){var n=this;return e.createIOPromise(function(t,e){setTimeout(function(){return t(r)},n.delay)})},t.prototype.reject=function(r){var n=this;return e.createIOPromise(function(t,e){setTimeout(function(){return e(r)},n.delay)})},t.prototype.generateId=function(t){var e=Number(t);return isNaN(e)||(this.index[0]=Math.max(this.index[0],e)),t||String(this.index[0]++)},t.prototype.create=function(t,e){var r=t.id=this.generateId(t.id);return this.index.push(r),this.items[r]=t,this.resolve({id:r})},t.prototype.update=function(t,e,r){return this.items[t]=e,this.resolve({})},t.prototype.read=function(t,e){var r=this.items[t];return r?this.resolve(r):this.reject("Not found")},t.prototype.destroy=function(e,t){return this.items[e]?(delete this.items[e],this.index=this.index.filter(function(t){return t!==e}),this.resolve({})):this.reject("Not found")},t.prototype.list=function(t){var e=this;return this.resolve(this.index.slice(1).map(function(t){return e.items[t]}))},t.prototype.subscribe=function(t){},t.prototype.unsubscribe=function(t){},t}();function r(t,e){return new s(t,e)}var s=function(){function u(t,e){void 0===e&&(e={});var r,n,o=e.mockData,i=e.simulateDelay,s=void 0===i?1e3:i,u=a(e,["mockData","simulateDelay"]);this.url=t,this.fetchOptions=u,this.memoryIO=o?(void 0===(r=o)&&(r=[]),void 0===(n=s)&&(n=50),new l(r,n)):null}return u.prototype.create=function(t,e,r){return this.memoryIO?this.memoryIO.create.apply(this.memoryIO,arguments):this.request("POST",this.collectionUrl(r,e),e,t)},u.prototype.update=function(t,e,r,n){return this.memoryIO?this.memoryIO.update.apply(this.memoryIO,arguments):this.request("PUT",this.objectUrl(n,t,r),r,e)},u.prototype.read=function(t,e,r){return this.memoryIO?this.memoryIO.read.apply(this.memoryIO,arguments):this.request("GET",this.objectUrl(r,t,e),e)},u.prototype.destroy=function(t,e,r){return this.memoryIO?this.memoryIO.destroy.apply(this.memoryIO,arguments):this.request("DELETE",this.objectUrl(r,t,e),e)},u.prototype.list=function(t,e){return this.memoryIO?this.memoryIO.list.apply(this.memoryIO,arguments):this.request("GET",this.collectionUrl(e,t),t)},u.prototype.subscribe=function(t){},u.prototype.unsubscribe=function(t){},u.prototype.isRelativeUrl=function(t){return 0===t.indexOf("./")},u.prototype.removeTrailingSlash=function(t){return"/"===t.charAt(t.length-1)?t.substr(0,t.length-1):t},u.prototype.getRootUrl=function(t){var e=this.url;if(this.isRelativeUrl(e)){var r=t.getOwner(),n=r.getEndpoint().getUrl(r);return this.removeTrailingSlash(n)+"/"+e.substr(2)}return e},u.prototype.getUrl=function(t){var e=this.getRootUrl(t);return t.isNew()?e:this.removeTrailingSlash(e)+"/"+t.id},u.prototype.objectUrl=function(t,e,r){return p(this.getUrl(t),r.params)},u.prototype.collectionUrl=function(t,e){return p(this.getRootUrl(t),e.params)},u.prototype.buildRequestOptions=function(t,e,r){var n=c({},u.defaultFetchOptions,this.fetchOptions,e),o=n.headers,i=a(n,["headers"]),s=c({method:t,headers:c({"Content-Type":"application/json"},o)},i);return r&&(s.body=JSON.stringify(r)),s},u.prototype.request=function(t,e,r,n){var o=r.options;return fetch(e,this.buildRequestOptions(t,o,n)).then(function(t){if(t.ok)return t.json();throw new Error(t.statusText)})},u.defaultFetchOptions={cache:"no-cache",credentials:"same-origin",mode:"cors",redirect:"error"},u}();function p(t,e){var r=encodeURIComponent;return e?t+"?"+Object.keys(e).map(function(t){return r(t)+"="+r(e[t])}).join("&"):t}function u(t){throw new ReferenceError("Method "+t+" is not supported. modelFetchIO supports only model.fetch().")}var f=function(s){function t(t,e,r){void 0===r&&(r={});var n=r.mockData,o=a(r,["mockData"]),i=s.call(this,"",n?c({mockData:[n]},o):o)||this;return i.method=t,i.constructUrl=e,i}return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(t,s),t.prototype.list=function(){return o(this,void 0,void 0,function(){return i(this,function(t){return u("collection.fetch()"),[2]})})},t.prototype.destroy=function(){return o(this,void 0,void 0,function(){return i(this,function(t){return u("model.destroy()"),[2]})})},t.prototype.create=function(){return o(this,void 0,void 0,function(){return i(this,function(t){return u("model.save()"),[2]})})},t.prototype.update=function(){return o(this,void 0,void 0,function(){return i(this,function(t){return u("model.save()"),[2]})})},t.prototype.read=function(t,e,r){return o(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return this.memoryIO?[4,this.memoryIO.list(e)]:[3,2];case 1:return[2,t.sent()[0]];case 2:return this.url=this.constructUrl(e.params,r),[2,this.request(this.method,this.getRootUrl(r),e)]}})})},t=function(t,e,r,n){var o,i=arguments.length,s=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,n);else for(var u=t.length-1;0<=u;u--)(o=t[u])&&(s=(i<3?o(s):3<i?o(e,r,s):o(e,r))||s);return 3<i&&s&&Object.defineProperty(e,r,s),s}([e.define],t)}(s);t.create=r,t.restfulIO=r,t.RestfulEndpoint=s,t.fetchModelIO=function(t,e,r){return new f(t,e,r)},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index.js.map
